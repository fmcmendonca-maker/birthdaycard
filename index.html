<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Buon Compleanno Amore Mio âœ¨</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- PWA Support -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#ff6b9d">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Compleanno 56">
<link rel="apple-touch-icon" href="icon-192.png">

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Montserrat:wght@200;300;400&family=Great+Vibes&display=swap" rel="stylesheet">

<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: 'Montserrat', sans-serif;
        font-weight: 300;
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f0f23 100%);
        color: #fff;
        text-align: center;
        overflow-x: hidden;
        min-height: 100vh;
        position: relative;
    }

    /* ========== ENVELOPE INTRO ========== */
    .envelope-intro {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f0f23 100%);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        cursor: pointer;
        transition: opacity 1s ease, visibility 1s ease;
    }

    .envelope-intro.hidden {
        opacity: 0;
        visibility: hidden;
        pointer-events: none;
    }

    .envelope-intro-stars {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        z-index: 0;
    }

    .envelope-container {
        position: relative;
        z-index: 10;
        perspective: 1000px;
    }

    .envelope {
        width: 320px;
        height: 220px;
        position: relative;
        transform-style: preserve-3d;
        transition: transform 0.8s ease;
    }

    .envelope:hover {
        transform: scale(1.05);
    }

    .envelope-body {
        width: 100%;
        height: 100%;
        background: linear-gradient(145deg, #f5e6d3, #e8d5c4);
        border-radius: 10px;
        position: relative;
        box-shadow: 
            0 20px 60px rgba(0, 0, 0, 0.4),
            0 0 100px rgba(255, 107, 157, 0.2),
            inset 0 -5px 20px rgba(0, 0, 0, 0.1);
    }

    .envelope-flap {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 50%;
        background: linear-gradient(180deg, #e8d5c4 0%, #d4c4b0 100%);
        clip-path: polygon(0 0, 50% 100%, 100% 0);
        transform-origin: top center;
        transition: transform 0.6s ease;
        z-index: 2;
    }

    .envelope.open .envelope-flap {
        transform: rotateX(180deg);
    }

    .envelope-flap::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(180deg, transparent 60%, rgba(0,0,0,0.1) 100%);
        clip-path: polygon(0 0, 50% 100%, 100% 0);
    }

    .envelope-inner {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 60%;
        background: linear-gradient(180deg, #fff5eb 0%, #f5e6d3 100%);
        clip-path: polygon(0 0, 50% 70%, 100% 0);
        z-index: 1;
    }

    .envelope-seal {
        position: absolute;
        top: 5px;
        left: 50%;
        transform: translateX(-50%);
        width: 50px;
        height: 50px;
        background: linear-gradient(135deg, #c41e3a, #8b0000);
        border-radius: 50%;
        z-index: 3;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        box-shadow: 
            0 4px 15px rgba(0, 0, 0, 0.3),
            inset 0 2px 5px rgba(255, 255, 255, 0.3);
        transition: transform 0.3s ease;
    }

    .envelope:hover .envelope-seal {
        transform: translateX(-50%) scale(1.1);
    }

    .envelope-label {
        position: absolute;
        bottom: 35%;
        left: 50%;
        transform: translateX(-50%);
        font-family: 'Great Vibes', cursive;
        font-size: 2.2rem;
        color: #4a3728;
        white-space: nowrap;
        text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
    }

    .envelope-decoration {
        position: absolute;
        bottom: 15px;
        left: 50%;
        transform: translateX(-50%);
        font-size: 1.2rem;
        opacity: 0.6;
    }

    .click-hint {
        margin-top: 40px;
        font-family: 'Montserrat', sans-serif;
        font-size: 1rem;
        color: rgba(255, 255, 255, 0.6);
        letter-spacing: 3px;
        text-transform: uppercase;
        animation: fadeInOut 2s ease-in-out infinite;
    }

    @keyframes fadeInOut {
        0%, 100% { opacity: 0.4; }
        50% { opacity: 1; }
    }

    .floating-sparkles {
        position: absolute;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 5;
    }

    .sparkle {
        position: absolute;
        font-size: 1.5rem;
        animation: sparkleFloat 3s ease-in-out infinite;
    }

    @keyframes sparkleFloat {
        0%, 100% { 
            transform: translateY(0) scale(1);
            opacity: 0.7;
        }
        50% { 
            transform: translateY(-20px) scale(1.2);
            opacity: 1;
        }
    }

    /* Main content initially hidden */
    .main-content {
        display: none;
    }

    .main-content.visible {
        display: block;
        animation: fadeInContent 1s ease-out;
    }

    @keyframes fadeInContent {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* ========== END ENVELOPE INTRO ========== */

    /* Animated Stars Background */
    .stars {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 0;
        overflow: hidden;
    }

    .star {
        position: absolute;
        width: 3px;
        height: 3px;
        background: #fff;
        border-radius: 50%;
        animation: twinkle 2s ease-in-out infinite;
    }

    @keyframes twinkle {
        0%, 100% { opacity: 0.3; transform: scale(1); }
        50% { opacity: 1; transform: scale(1.5); }
    }

    /* Floating Particles */
    .particles {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 1;
        overflow: hidden;
    }

    .particle {
        position: absolute;
        width: 10px;
        height: 10px;
        background: radial-gradient(circle, rgba(255,215,0,0.8) 0%, transparent 70%);
        border-radius: 50%;
        animation: floatParticle 15s linear infinite;
    }

    @keyframes floatParticle {
        0% {
            transform: translateY(100vh) rotate(0deg);
            opacity: 0;
        }
        10% { opacity: 1; }
        90% { opacity: 1; }
        100% {
            transform: translateY(-100px) rotate(720deg);
            opacity: 0;
        }
    }

    /* Aurora Effect */
    .aurora {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 0;
        opacity: 0.3;
        background: 
            radial-gradient(ellipse at 20% 20%, rgba(255, 107, 157, 0.4) 0%, transparent 50%),
            radial-gradient(ellipse at 80% 30%, rgba(147, 112, 219, 0.4) 0%, transparent 50%),
            radial-gradient(ellipse at 50% 80%, rgba(255, 193, 7, 0.3) 0%, transparent 50%);
        animation: aurora 8s ease-in-out infinite alternate;
    }

    @keyframes aurora {
        0% { 
            transform: scale(1) rotate(0deg);
            filter: hue-rotate(0deg);
        }
        100% { 
            transform: scale(1.1) rotate(5deg);
            filter: hue-rotate(30deg);
        }
    }

    h1, h2, h3 {
        font-family: 'Playfair Display', serif;
        font-weight: 400;
        letter-spacing: 2px;
    }

    /* Hero Section */
    .hero {
        padding: 100px 20px 80px;
        position: relative;
        z-index: 10;
    }

    .hero-decoration {
        font-size: 3rem;
        margin-bottom: 30px;
        animation: sparkle 2s ease-in-out infinite;
    }

    @keyframes sparkle {
        0%, 100% { 
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.8), 0 0 40px rgba(255, 215, 0, 0.4);
            transform: scale(1);
        }
        50% { 
            text-shadow: 0 0 40px rgba(255, 215, 0, 1), 0 0 80px rgba(255, 215, 0, 0.6);
            transform: scale(1.1);
        }
    }

    .hero h1 {
        font-size: clamp(2rem, 5vw, 3.5rem);
        color: #fff;
        margin-bottom: 20px;
        text-shadow: 0 0 30px rgba(255, 255, 255, 0.3);
        animation: fadeInUp 1s ease-out;
    }

    .hero .script-title {
        font-family: 'Great Vibes', cursive;
        font-size: clamp(3.5rem, 10vw, 7rem);
        background: linear-gradient(135deg, #ff6b9d, #ffc107, #ff6b9d, #c084fc);
        background-size: 300% 300%;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        animation: gradientShift 4s ease-in-out infinite, fadeInUp 1.2s ease-out;
        filter: drop-shadow(0 0 30px rgba(255, 107, 157, 0.5));
    }

    @keyframes gradientShift {
        0%, 100% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
    }

    .subtitle {
        font-family: 'Playfair Display', serif;
        font-style: italic;
        font-size: 1.4rem;
        color: rgba(255, 255, 255, 0.8);
        margin-top: 25px;
        letter-spacing: 3px;
        animation: fadeInUp 1.4s ease-out;
    }

    .age-highlight {
        display: inline-block;
        font-size: 2rem;
        font-weight: 700;
        color: #ffc107;
        text-shadow: 0 0 20px rgba(255, 193, 7, 0.8);
        animation: pulse 1.5s ease-in-out infinite;
    }

    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(40px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* Container */
    .container {
        max-width: 900px;
        margin: auto;
        padding: 0 20px;
        position: relative;
        z-index: 10;
    }

    /* Neon Divider */
    .divider {
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 60px auto;
        max-width: 500px;
    }

    .divider-line {
        flex: 1;
        height: 2px;
        background: linear-gradient(90deg, transparent, #ff6b9d, #ffc107, #ff6b9d, transparent);
        box-shadow: 0 0 10px rgba(255, 107, 157, 0.5);
    }

    .divider-ornament {
        margin: 0 25px;
        font-size: 2rem;
        animation: rotate 4s linear infinite;
    }

    @keyframes rotate {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }

    /* Quote Sections */
    .quotes-section {
        padding: 40px 0;
    }

    .quote-card {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 20px;
        padding: 45px;
        margin: 35px auto;
        max-width: 750px;
        position: relative;
        box-shadow: 
            0 20px 60px rgba(0, 0, 0, 0.3),
            inset 0 1px 0 rgba(255, 255, 255, 0.1);
        transition: all 0.4s ease;
        overflow: hidden;
    }

    .quote-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, #ff6b9d, #ffc107, #c084fc);
    }

    .quote-card::after {
        content: '"';
        position: absolute;
        top: 20px;
        left: 30px;
        font-family: 'Playfair Display', serif;
        font-size: 5rem;
        color: rgba(255, 107, 157, 0.2);
        line-height: 1;
    }

    .quote-card:hover {
        transform: translateY(-10px) scale(1.02);
        box-shadow: 
            0 30px 80px rgba(0, 0, 0, 0.4),
            0 0 40px rgba(255, 107, 157, 0.2);
        border-color: rgba(255, 107, 157, 0.3);
    }

    .quote-text {
        font-family: 'Playfair Display', serif;
        font-size: 1.5rem;
        font-style: italic;
        line-height: 1.9;
        color: rgba(255, 255, 255, 0.9);
    }

    .quote-category {
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 4px;
        background: linear-gradient(90deg, #ff6b9d, #ffc107);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-top: 25px;
        font-weight: 400;
    }

    /* Slider Section */
    .slider-section {
        padding: 100px 20px;
        position: relative;
        z-index: 10;
    }

    .slider-section h2 {
        font-size: 2.5rem;
        color: #fff;
        margin-bottom: 15px;
        text-shadow: 0 0 30px rgba(255, 255, 255, 0.3);
    }

    .slider-subtitle {
        font-style: italic;
        color: rgba(255, 255, 255, 0.6);
        margin-bottom: 50px;
        font-size: 1.1rem;
    }

    .slider-container {
        max-width: 650px;
        margin: 0 auto;
        padding: 50px 40px;
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(20px);
        border-radius: 30px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 25px 80px rgba(0, 0, 0, 0.3);
    }

    .slider-label {
        display: flex;
        justify-content: space-between;
        font-size: 0.9rem;
        color: rgba(255, 255, 255, 0.5);
        margin-bottom: 20px;
    }

    input[type=range] {
        -webkit-appearance: none;
        width: 100%;
        height: 12px;
        border-radius: 10px;
        background: linear-gradient(90deg, #1a1a2e 0%, #ff6b9d 50%, #ffc107 100%);
        outline: none;
        cursor: pointer;
        box-shadow: 0 0 20px rgba(255, 107, 157, 0.3);
    }

    input[type=range]::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 35px;
        height: 35px;
        border-radius: 50%;
        background: linear-gradient(135deg, #ff6b9d, #ffc107);
        cursor: pointer;
        box-shadow: 0 0 30px rgba(255, 107, 157, 0.8), 0 0 60px rgba(255, 193, 7, 0.4);
        transition: all 0.3s ease;
        border: 3px solid #fff;
    }

    input[type=range]::-webkit-slider-thumb:hover {
        transform: scale(1.2);
        box-shadow: 0 0 50px rgba(255, 107, 157, 1), 0 0 100px rgba(255, 193, 7, 0.6);
    }

    input[type=range]::-moz-range-thumb {
        width: 35px;
        height: 35px;
        border-radius: 50%;
        background: linear-gradient(135deg, #ff6b9d, #ffc107);
        cursor: pointer;
        border: 3px solid #fff;
        box-shadow: 0 0 30px rgba(255, 107, 157, 0.8);
    }

    .age-display {
        margin-top: 40px;
    }

    .age-number {
        font-family: 'Playfair Display', serif;
        font-size: 7rem;
        font-weight: 700;
        background: linear-gradient(135deg, #ff6b9d, #ffc107, #c084fc);
        background-size: 200% 200%;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        animation: gradientShift 3s ease-in-out infinite;
        line-height: 1;
        filter: drop-shadow(0 0 30px rgba(255, 107, 157, 0.5));
    }

    .age-number.pulse {
        animation: pulseBig 0.3s ease;
    }

    @keyframes pulseBig {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.15); }
    }

    .age-label {
        font-size: 1.1rem;
        color: rgba(255, 255, 255, 0.6);
        letter-spacing: 5px;
        text-transform: uppercase;
        margin-top: 15px;
    }

    /* Celebrate Button */
    .celebrate-btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        margin-top: 40px;
        padding: 20px 50px;
        background: linear-gradient(135deg, #ff6b9d, #c084fc, #ffc107);
        background-size: 200% 200%;
        border: none;
        border-radius: 60px;
        color: #fff;
        font-family: 'Montserrat', sans-serif;
        font-size: 1rem;
        font-weight: 400;
        letter-spacing: 3px;
        text-transform: uppercase;
        cursor: pointer;
        box-shadow: 
            0 10px 40px rgba(255, 107, 157, 0.4),
            0 0 60px rgba(192, 132, 252, 0.3);
        transition: all 0.4s ease;
        animation: gradientShift 3s ease-in-out infinite;
        position: relative;
        overflow: hidden;
    }

    .celebrate-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
        transition: left 0.6s ease;
    }

    .celebrate-btn:hover {
        transform: translateY(-5px) scale(1.05);
        box-shadow: 
            0 20px 60px rgba(255, 107, 157, 0.5),
            0 0 100px rgba(192, 132, 252, 0.4);
    }

    .celebrate-btn:hover::before {
        left: 100%;
    }

    .celebrate-btn:disabled {
        opacity: 0.8;
        cursor: not-allowed;
    }

    .celebrate-btn .btn-icon {
        font-size: 1.3rem;
    }

    /* Birthday Message */
    #birthdayMessage {
        display: none;
        margin: 60px auto;
        padding: 60px;
        max-width: 900px;
        position: relative;
        z-index: 10;
    }

    .birthday-text {
        font-family: 'Great Vibes', cursive;
        font-size: clamp(3.5rem, 10vw, 6rem);
        background: linear-gradient(135deg, #ff6b9d, #ffc107, #c084fc, #ff6b9d);
        background-size: 300% 300%;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        animation: gradientShift 3s ease-in-out infinite;
        filter: drop-shadow(0 0 40px rgba(255, 107, 157, 0.6));
        margin-bottom: 30px;
    }

    .birthday-age {
        font-family: 'Playfair Display', serif;
        font-size: clamp(8rem, 20vw, 12rem);
        font-weight: 700;
        background: linear-gradient(135deg, #ffc107, #ff6b9d, #c084fc);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        line-height: 1;
        margin: 30px 0;
        animation: celebrationPulse 1s ease-in-out infinite;
        filter: drop-shadow(0 0 50px rgba(255, 193, 7, 0.6));
    }

    @keyframes celebrationPulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.05); }
    }

    .birthday-hearts {
        font-size: 3rem;
        animation: heartbeat 0.8s ease-in-out infinite;
    }

    @keyframes heartbeat {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.3); }
    }

    /* Album Link */
    .album-section {
        padding: 80px 20px;
        position: relative;
        z-index: 10;
    }

    .album-link {
        display: inline-flex;
        align-items: center;
        gap: 20px;
        padding: 25px 60px;
        background: transparent;
        border: 2px solid rgba(255, 107, 157, 0.5);
        border-radius: 60px;
        color: #fff;
        text-decoration: none;
        font-size: 1rem;
        letter-spacing: 3px;
        text-transform: uppercase;
        transition: all 0.4s ease;
        position: relative;
        overflow: hidden;
    }

    .album-link::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 0%;
        height: 100%;
        background: linear-gradient(90deg, #ff6b9d, #c084fc);
        transition: width 0.4s ease;
        z-index: -1;
    }

    .album-link:hover::before {
        width: 100%;
    }

    .album-link:hover {
        border-color: transparent;
        box-shadow: 0 0 40px rgba(255, 107, 157, 0.5);
        transform: translateY(-3px);
    }

    .album-icon {
        font-size: 1.5rem;
    }

    /* Photo Gallery */
    .gallery-title {
        font-family: 'Playfair Display', serif;
        font-size: 2.5rem;
        color: #fff;
        margin-bottom: 15px;
        text-shadow: 0 0 30px rgba(255, 255, 255, 0.3);
    }

    .gallery-subtitle {
        font-style: italic;
        color: rgba(255, 255, 255, 0.6);
        margin-bottom: 50px;
        font-size: 1.1rem;
    }

    .photo-gallery {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 20px;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
    }

    .photo-card {
        position: relative;
        border-radius: 15px;
        overflow: hidden;
        aspect-ratio: 1;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        transition: all 0.4s ease;
        cursor: pointer;
    }

    .photo-card:hover {
        transform: translateY(-10px) scale(1.03);
        box-shadow: 0 20px 60px rgba(255, 107, 157, 0.3);
        border-color: rgba(255, 107, 157, 0.5);
    }

    .photo-card img,
    .photo-card video {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.4s ease;
    }

    .photo-card:hover img,
    .photo-card:hover video {
        transform: scale(1.1);
    }

    .photo-card .video-indicator {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 3rem;
        color: #fff;
        text-shadow: 0 0 20px rgba(0,0,0,0.8);
        z-index: 10;
        pointer-events: none;
        opacity: 0.9;
    }

    .photo-card:hover .video-indicator {
        opacity: 1;
        animation: pulse 1s ease-in-out infinite;
    }

    @keyframes pulse {
        0%, 100% { transform: translate(-50%, -50%) scale(1); }
        50% { transform: translate(-50%, -50%) scale(1.1); }
    }

    .photo-card::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(180deg, transparent 60%, rgba(0,0,0,0.5) 100%);
        opacity: 0;
        transition: opacity 0.4s ease;
    }

    .photo-card:hover::after {
        opacity: 1;
    }

    /* Lightbox */
    .lightbox {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.95);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        cursor: pointer;
    }

    .lightbox.active {
        display: flex;
    }

    .lightbox img,
    .lightbox video {
        max-width: 90%;
        max-height: 90%;
        object-fit: contain;
        border-radius: 10px;
        box-shadow: 0 0 60px rgba(255, 107, 157, 0.3);
    }

    .lightbox-close {
        position: absolute;
        top: 30px;
        right: 30px;
        font-size: 3rem;
        color: #fff;
        cursor: pointer;
        transition: transform 0.3s ease;
    }

    .lightbox-close:hover {
        transform: scale(1.2);
    }

    @media (max-width: 768px) {
        .photo-gallery {
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            padding: 10px;
        }
    }

    @media (max-width: 480px) {
        .photo-gallery {
            grid-template-columns: 1fr;
        }
    }

    /* Flashing Photo Card */
    .flash-photo-container {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 200;
        display: none;
        pointer-events: none;
    }

    .flash-photo-container.active {
        display: block;
    }

    .flash-photo-card {
        width: 120px;
        height: 120px;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 0 40px rgba(255, 107, 157, 0.8), 0 0 80px rgba(255, 193, 7, 0.5);
        border: 3px solid rgba(255, 255, 255, 0.8);
        animation: flashPulse 0.15s ease-in-out;
    }

    .flash-photo-card img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    @keyframes flashPulse {
        0% { transform: scale(0.5); opacity: 0; }
        50% { transform: scale(1.1); opacity: 1; }
        100% { transform: scale(1); opacity: 1; }
    }

    /* Footer */
    footer {
        padding: 80px 20px;
        position: relative;
        z-index: 10;
        background: linear-gradient(180deg, transparent, rgba(0, 0, 0, 0.3));
    }

    .footer-heart {
        font-size: 4rem;
        margin-bottom: 25px;
        animation: heartGlow 2s ease-in-out infinite;
    }

    @keyframes heartGlow {
        0%, 100% { 
            filter: drop-shadow(0 0 20px rgba(255, 107, 157, 0.8));
            transform: scale(1);
        }
        50% { 
            filter: drop-shadow(0 0 40px rgba(255, 107, 157, 1));
            transform: scale(1.1);
        }
    }

    .footer-message {
        font-family: 'Playfair Display', serif;
        font-style: italic;
        font-size: 1.4rem;
        color: rgba(255, 255, 255, 0.8);
        margin-bottom: 15px;
    }

    .footer-signature {
        font-family: 'Great Vibes', cursive;
        font-size: 3rem;
        background: linear-gradient(90deg, #ff6b9d, #ffc107);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-top: 25px;
    }

    .footer-date {
        font-size: 0.9rem;
        color: rgba(255, 255, 255, 0.4);
        margin-top: 20px;
        letter-spacing: 3px;
    }

    /* PWA Install Button */
    .install-btn {
        display: none;
        align-items: center;
        justify-content: center;
        gap: 10px;
        margin-top: 30px;
        padding: 15px 35px;
        background: linear-gradient(135deg, #667eea, #764ba2);
        border: none;
        border-radius: 50px;
        color: #fff;
        font-family: 'Montserrat', sans-serif;
        font-size: 0.9rem;
        font-weight: 400;
        cursor: pointer;
        box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        transition: all 0.3s ease;
        animation: pulseGlow 2s ease-in-out infinite;
    }

    .install-btn:hover {
        transform: translateY(-3px) scale(1.05);
        box-shadow: 0 15px 40px rgba(102, 126, 234, 0.6);
    }

    @keyframes pulseGlow {
        0%, 100% { box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4); }
        50% { box-shadow: 0 10px 40px rgba(118, 75, 162, 0.6); }
    }

    .install-btn .install-icon {
        font-size: 1.2rem;
    }

    /* Floating Hearts Animation */
    .floating-hearts {
        position: fixed;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        pointer-events: none;
        z-index: 100;
        display: none;
    }

    .heart {
        position: absolute;
        font-size: 2rem;
        animation: floatUp 5s ease-in forwards;
        opacity: 0;
        filter: drop-shadow(0 0 10px currentColor);
    }

    @keyframes floatUp {
        0% {
            opacity: 1;
            transform: translateY(100vh) rotate(0deg) scale(0.5);
        }
        50% {
            opacity: 1;
            transform: translateY(50vh) rotate(180deg) scale(1);
        }
        100% {
            opacity: 0;
            transform: translateY(-100px) rotate(360deg) scale(0.5);
        }
    }

    /* Canvas for Fireworks */
    canvas {
        position: fixed;
        top: 0;
        left: 0;
        pointer-events: none;
        z-index: 99;
    }

    /* ========== MUSIC PLAYER ========== */
    .music-player {
        position: fixed;
        bottom: 30px;
        right: 30px;
        z-index: 1000;
        display: flex;
        align-items: center;
        gap: 15px;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(20px);
        padding: 15px 25px;
        border-radius: 50px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        transition: all 0.3s ease;
    }

    .music-player:hover {
        background: rgba(255, 255, 255, 0.15);
        box-shadow: 0 15px 50px rgba(255, 107, 157, 0.3);
    }

    .music-btn {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        border: none;
        background: linear-gradient(135deg, #ff6b9d, #ffc107);
        color: #fff;
        font-size: 1.5rem;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        box-shadow: 0 5px 20px rgba(255, 107, 157, 0.4);
    }

    .music-btn:hover {
        transform: scale(1.1);
        box-shadow: 0 8px 30px rgba(255, 107, 157, 0.6);
    }

    .music-btn.playing {
        animation: musicPulse 1s ease-in-out infinite;
    }

    @keyframes musicPulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.05); }
    }

    .music-info {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        max-width: 150px;
    }

    .music-title {
        font-size: 0.75rem;
        color: rgba(255, 255, 255, 0.9);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        width: 100%;
    }

    .music-artist {
        font-size: 0.65rem;
        color: rgba(255, 255, 255, 0.5);
    }

    .music-bars {
        display: flex;
        align-items: flex-end;
        gap: 3px;
        height: 20px;
    }

    .music-bar {
        width: 4px;
        background: linear-gradient(180deg, #ff6b9d, #ffc107);
        border-radius: 2px;
        animation: musicBar 0.5s ease-in-out infinite;
        animation-play-state: paused;
    }

    .music-bar:nth-child(1) { height: 60%; animation-delay: 0s; }
    .music-bar:nth-child(2) { height: 100%; animation-delay: 0.1s; }
    .music-bar:nth-child(3) { height: 40%; animation-delay: 0.2s; }
    .music-bar:nth-child(4) { height: 80%; animation-delay: 0.3s; }

    .music-player.playing .music-bar {
        animation-play-state: running;
    }

    @keyframes musicBar {
        0%, 100% { transform: scaleY(1); }
        50% { transform: scaleY(0.5); }
    }

    @media (max-width: 768px) {
        .music-player {
            bottom: 20px;
            right: 20px;
            padding: 10px 15px;
        }
        
        .music-btn {
            width: 40px;
            height: 40px;
            font-size: 1.2rem;
        }
        
        .music-info {
            display: none;
        }
    }

    /* Responsive */
    @media (max-width: 768px) {
        .hero {
            padding: 70px 20px 50px;
        }

        .quote-card {
            padding: 35px 25px;
            margin: 25px 15px;
        }

        .quote-text {
            font-size: 1.2rem;
        }

        .slider-section {
            padding: 60px 15px;
        }

        .slider-container {
            padding: 35px 25px;
        }

        .age-number {
            font-size: 5rem;
        }

        .birthday-age {
            font-size: 6rem;
        }

        .album-link {
            padding: 18px 40px;
            font-size: 0.85rem;
        }

        .celebrate-btn {
            padding: 16px 35px;
            font-size: 0.85rem;
        }
    }

    /* Confetti styles */
    .confetti {
        position: fixed;
        width: 12px;
        height: 12px;
        top: -20px;
        animation: confettiFall 4s linear forwards;
        z-index: 101;
    }

    @keyframes confettiFall {
        0% {
            transform: translateY(0) rotate(0deg) scale(1);
            opacity: 1;
        }
        100% {
            transform: translateY(100vh) rotate(1080deg) scale(0);
            opacity: 0;
        }
    }

    /* Shooting Stars */
    .shooting-star {
        position: fixed;
        width: 4px;
        height: 4px;
        background: linear-gradient(90deg, #fff, transparent);
        border-radius: 50%;
        animation: shoot 1s ease-out forwards;
        z-index: 5;
    }

    @keyframes shoot {
        0% {
            transform: translateX(0) translateY(0);
            opacity: 1;
            width: 4px;
        }
        100% {
            transform: translateX(300px) translateY(300px);
            opacity: 0;
            width: 100px;
        }
    }

    /* ========== VISUAL ENHANCEMENTS ========== */
    
    /* Nebula/Galaxy Effect */
    .nebula {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 0;
        opacity: 0.5;
    }
    
    .nebula-cloud {
        position: absolute;
        border-radius: 50%;
        filter: blur(80px);
        animation: nebulaFloat 20s ease-in-out infinite;
    }
    
    .nebula-cloud:nth-child(1) {
        width: 600px;
        height: 600px;
        background: radial-gradient(circle, rgba(255, 107, 157, 0.4) 0%, transparent 70%);
        top: -200px;
        left: -200px;
        animation-delay: 0s;
    }
    
    .nebula-cloud:nth-child(2) {
        width: 500px;
        height: 500px;
        background: radial-gradient(circle, rgba(147, 112, 219, 0.4) 0%, transparent 70%);
        top: 50%;
        right: -150px;
        animation-delay: -5s;
    }
    
    .nebula-cloud:nth-child(3) {
        width: 700px;
        height: 700px;
        background: radial-gradient(circle, rgba(255, 193, 7, 0.3) 0%, transparent 70%);
        bottom: -300px;
        left: 30%;
        animation-delay: -10s;
    }
    
    .nebula-cloud:nth-child(4) {
        width: 400px;
        height: 400px;
        background: radial-gradient(circle, rgba(0, 212, 255, 0.3) 0%, transparent 70%);
        top: 40%;
        left: 10%;
        animation-delay: -15s;
    }
    
    @keyframes nebulaFloat {
        0%, 100% {
            transform: translate(0, 0) scale(1);
            opacity: 0.5;
        }
        25% {
            transform: translate(50px, 30px) scale(1.1);
            opacity: 0.6;
        }
        50% {
            transform: translate(-30px, 60px) scale(0.9);
            opacity: 0.4;
        }
        75% {
            transform: translate(20px, -40px) scale(1.05);
            opacity: 0.55;
        }
    }

    /* Sparkle Cursor Trail */
    .cursor-sparkle {
        position: fixed;
        width: 10px;
        height: 10px;
        pointer-events: none;
        z-index: 9998;
        border-radius: 50%;
        animation: sparkleOut 0.8s ease-out forwards;
    }
    
    @keyframes sparkleOut {
        0% {
            transform: scale(1) rotate(0deg);
            opacity: 1;
        }
        100% {
            transform: scale(0) rotate(180deg);
            opacity: 0;
        }
    }

    /* Improved Text Glow Effects */
    .glow-text {
        text-shadow: 
            0 0 10px currentColor,
            0 0 20px currentColor,
            0 0 40px currentColor,
            0 0 80px currentColor;
        animation: textGlow 2s ease-in-out infinite alternate;
    }
    
    @keyframes textGlow {
        0% {
            filter: brightness(1) drop-shadow(0 0 20px rgba(255, 107, 157, 0.6));
        }
        100% {
            filter: brightness(1.2) drop-shadow(0 0 40px rgba(255, 107, 157, 0.9));
        }
    }

    /* Floating Orbs */
    .floating-orb {
        position: fixed;
        border-radius: 50%;
        pointer-events: none;
        z-index: 2;
        filter: blur(1px);
        animation: orbFloat 8s ease-in-out infinite;
    }
    
    @keyframes orbFloat {
        0%, 100% { transform: translateY(0) translateX(0); }
        25% { transform: translateY(-30px) translateX(20px); }
        50% { transform: translateY(-15px) translateX(-15px); }
        75% { transform: translateY(-40px) translateX(10px); }
    }

    /* Smooth Section Transitions */
    section, .quote-card, .photo-card, .slider-container {
        transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* Rainbow Border Animation */
    .rainbow-border {
        position: relative;
    }
    
    .rainbow-border::before {
        content: '';
        position: absolute;
        top: -2px;
        left: -2px;
        right: -2px;
        bottom: -2px;
        background: linear-gradient(45deg, #ff6b9d, #ffc107, #c084fc, #00d4ff, #ff6b9d);
        background-size: 400% 400%;
        border-radius: inherit;
        z-index: -1;
        animation: rainbowShift 3s linear infinite;
    }
    
    @keyframes rainbowShift {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }

    /* ========== SCRATCH CARD ========== */
    .scratch-section {
        padding: 80px 20px;
        position: relative;
        z-index: 10;
    }

    .scratch-section h2 {
        font-size: 2rem;
        margin-bottom: 15px;
        color: #fff;
    }

    .section-subtitle {
        color: rgba(255, 255, 255, 0.6);
        margin-bottom: 30px;
        font-style: italic;
    }

    .scratch-subtitle {
        color: rgba(255, 255, 255, 0.6);
        margin-bottom: 30px;
        font-style: italic;
    }

    .scratch-container {
        position: relative;
        width: 320px;
        height: 200px;
        margin: 0 auto;
        border-radius: 20px;
        overflow: hidden;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
    }

    .scratch-reveal {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #ff6b9d, #ffc107);
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
    }

    .scratch-message {
        font-family: 'Great Vibes', cursive;
        font-size: 2rem;
        color: #fff;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
    }

    .scratch-hint {
        margin-top: 15px;
        font-size: 0.9rem;
        color: rgba(255, 255, 255, 0.5);
    }

    .scratch-card {
        position: relative;
        width: 300px;
        height: 200px;
        margin: 0 auto;
        border-radius: 20px;
        overflow: hidden;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
    }

    .scratch-message {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #ff6b9d, #ffc107);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 20px;
        text-align: center;
    }

    .scratch-emoji {
        font-size: 3rem;
        margin-bottom: 10px;
    }

    .scratch-text {
        font-family: 'Great Vibes', cursive;
        font-size: 1.5rem;
        color: #fff;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
    }

    .scratch-canvas {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        cursor: crosshair;
        border-radius: 20px;
        z-index: 10;
        touch-action: none;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        user-select: none;
    }

    .scratch-btn {
        margin-top: 30px;
        padding: 15px 40px;
        background: linear-gradient(135deg, #ffc107, #ff6b9d);
        border: none;
        border-radius: 50px;
        color: #fff;
        font-family: 'Montserrat', sans-serif;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 10px 30px rgba(255, 193, 7, 0.4);
    }

    .scratch-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 15px 40px rgba(255, 193, 7, 0.6);
    }

    /* ========== SPIN WHEEL ========== */
    .spin-section {
        padding: 80px 20px;
        position: relative;
        z-index: 10;
    }

    .spin-section h2 {
        font-size: 2rem;
        margin-bottom: 15px;
        color: #fff;
    }

    .wheel-section {
        padding: 80px 20px;
        position: relative;
        z-index: 10;
    }

    .wheel-section h2 {
        font-size: 2rem;
        margin-bottom: 15px;
        color: #fff;
    }

    .wheel-subtitle {
        color: rgba(255, 255, 255, 0.6);
        margin-bottom: 30px;
        font-style: italic;
    }

    .wheel-container {
        position: relative;
        width: 300px;
        height: 300px;
        margin: 0 auto;
    }

    .wheel {
        width: 100%;
        height: 100%;
        border-radius: 50%;
        position: relative;
        transition: transform 4s cubic-bezier(0.17, 0.67, 0.12, 0.99);
        box-shadow: 0 0 30px rgba(255, 107, 157, 0.5), 0 0 60px rgba(255, 193, 7, 0.3);
    }

    .wheel-pointer {
        position: absolute;
        top: -20px;
        left: 50%;
        transform: translateX(-50%);
        width: 0;
        height: 0;
        border-left: 20px solid transparent;
        border-right: 20px solid transparent;
        border-top: 40px solid #fff;
        z-index: 10;
        filter: drop-shadow(0 5px 10px rgba(0, 0, 0, 0.3));
    }

    .wheel-center {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 60px;
        height: 60px;
        background: linear-gradient(135deg, #ff6b9d, #ffc107);
        border-radius: 50%;
        border: 4px solid #fff;
        z-index: 5;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        cursor: pointer;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        transition: transform 0.3s ease;
    }

    .wheel-center:hover {
        transform: translate(-50%, -50%) scale(1.1);
    }

    .wheel-result {
        margin-top: 30px;
        padding: 20px 40px;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        display: none;
    }

    .wheel-result.show {
        display: block;
        animation: fadeInUp 0.5s ease-out;
    }

    .wheel-result-text {
        font-family: 'Great Vibes', cursive;
        font-size: 2rem;
        background: linear-gradient(90deg, #ff6b9d, #ffc107);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .wheel-segment {
        position: absolute;
        width: 50%;
        height: 50%;
        left: 50%;
        top: 0;
        transform-origin: 0% 100%;
        transform: rotate(calc(var(--i) * 45deg)) skewY(-45deg);
        background: var(--color);
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
    }

    .wheel-segment span {
        transform: skewY(45deg) rotate(22.5deg);
        color: #fff;
        font-size: 0.85rem;
        font-weight: bold;
        text-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        position: absolute;
        top: 40%;
        left: 30%;
    }

    .spin-btn {
        margin-bottom: 30px;
        padding: 18px 50px;
        background: linear-gradient(135deg, #9c27b0, #ff6b9d);
        border: none;
        border-radius: 50px;
        color: #fff;
        font-family: 'Montserrat', sans-serif;
        font-size: 1.1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 10px 30px rgba(156, 39, 176, 0.4);
    }

    .spin-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 15px 40px rgba(156, 39, 176, 0.6);
    }

    .spin-btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
    }

    .prize-emoji {
        font-size: 2rem;
        margin-right: 10px;
    }

    /* ========== LOVE LETTER GENERATOR ========== */
    .love-letter-section {
        padding: 80px 20px;
        position: relative;
        z-index: 10;
    }

    .love-letter-section h2 {
        font-size: 2rem;
        margin-bottom: 15px;
        color: #fff;
    }

    .letter-section {
        padding: 80px 20px;
        position: relative;
        z-index: 10;
    }

    .letter-section h2 {
        font-size: 2rem;
        margin-bottom: 15px;
        color: #fff;
    }

    .letter-subtitle {
        color: rgba(255, 255, 255, 0.6);
        margin-bottom: 30px;
        font-style: italic;
    }

    .letter-card {
        max-width: 500px;
        margin: 0 auto;
        padding: 40px;
        background: linear-gradient(145deg, #f5e6d3, #e8d5c4);
        border-radius: 10px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        position: relative;
        min-height: 250px;
    }

    .letter-card::before {
        content: '';
        position: absolute;
        top: 10px;
        left: 10px;
        right: 10px;
        bottom: 10px;
        border: 2px solid rgba(255, 107, 157, 0.3);
        border-radius: 5px;
        pointer-events: none;
    }

    .letter-text {
        font-family: 'Great Vibes', cursive;
        font-size: 1.8rem;
        color: #4a3728;
        line-height: 1.6;
        min-height: 150px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .letter-box {
        max-width: 500px;
        margin: 0 auto;
        padding: 40px;
        background: linear-gradient(145deg, #f5e6d3, #e8d5c4);
        border-radius: 10px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        position: relative;
        min-height: 250px;
        transition: all 0.3s ease;
    }

    .letter-box::before {
        content: '';
        position: absolute;
        top: 10px;
        left: 10px;
        right: 10px;
        bottom: 10px;
        border: 2px solid rgba(255, 107, 157, 0.3);
        border-radius: 5px;
        pointer-events: none;
    }

    .letter-header {
        font-family: 'Great Vibes', cursive;
        font-size: 1.8rem;
        color: #8b4d6b;
        margin-bottom: 20px;
    }

    .letter-content {
        font-family: 'Georgia', serif;
        font-size: 1rem;
        color: #4a3728;
        line-height: 1.8;
        transition: opacity 0.3s ease;
    }

    .letter-content p {
        margin-bottom: 15px;
    }

    @keyframes letterGlow {
        0% { box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); }
        50% { box-shadow: 0 20px 60px rgba(255, 107, 157, 0.5), 0 0 30px rgba(255, 193, 7, 0.3); }
        100% { box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); }
    }

    .letter-signature {
        font-family: 'Great Vibes', cursive;
        font-size: 1.5rem;
        color: #8b4d6b;
        margin-top: 20px;
        text-align: right;
    }

    .letter-btn {
        margin-top: 30px;
        padding: 15px 40px;
        background: linear-gradient(135deg, #ff6b9d, #c084fc);
        border: none;
        border-radius: 50px;
        color: #fff;
        font-family: 'Montserrat', sans-serif;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 10px 30px rgba(255, 107, 157, 0.4);
    }

    .letter-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 15px 40px rgba(255, 107, 157, 0.6);
    }

    /* ========== VIRTUAL CANDLES ========== */
    .candles-section {
        padding: 80px 20px;
        position: relative;
        z-index: 10;
    }

    .candles-section h2 {
        font-size: 2rem;
        margin-bottom: 15px;
        color: #fff;
    }

    .candles-subtitle {
        color: rgba(255, 255, 255, 0.6);
        margin-bottom: 20px;
        font-style: italic;
    }

    .candles-instruction {
        color: rgba(255, 255, 255, 0.8);
        margin-bottom: 30px;
        font-size: 0.9rem;
        padding: 15px 25px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 30px;
        display: inline-block;
    }

    .cake-container {
        position: relative;
        max-width: 400px;
        margin: 0 auto;
    }

    .cake {
        width: 100%;
        height: 150px;
        background: linear-gradient(180deg, #8B4513 0%, #D2691E 50%, #8B4513 100%);
        border-radius: 20px 20px 30px 30px;
        position: relative;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
    }

    .cake::before {
        content: '';
        position: absolute;
        top: -20px;
        left: 0;
        right: 0;
        height: 40px;
        background: linear-gradient(180deg, #ff6b9d 0%, #ff8fab 100%);
        border-radius: 20px 20px 0 0;
    }

    .cake::after {
        content: 'ðŸŽ‚';
        position: absolute;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        font-size: 3rem;
    }

    .candles-container {
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        gap: 4px;
        margin-bottom: 20px;
        max-width: 350px;
        margin-left: auto;
        margin-right: auto;
    }

    .candle {
        width: 8px;
        height: 40px;
        background: linear-gradient(180deg, #ffc107 0%, #ff9800 100%);
        border-radius: 2px 2px 0 0;
        position: relative;
    }

    .candle-flame {
        position: absolute;
        top: -20px;
        left: 50%;
        transform: translateX(-50%);
        width: 12px;
        height: 20px;
        background: radial-gradient(ellipse at bottom, #ffc107 0%, #ff6b00 40%, #ff0000 100%);
        border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
        animation: flicker 0.3s ease-in-out infinite alternate;
        box-shadow: 0 0 10px #ffc107, 0 0 20px #ff6b00, 0 0 30px #ff0000;
    }

    .candle-flame.blown {
        animation: blowOut 0.5s ease-out forwards;
    }

    @keyframes flicker {
        0% { transform: translateX(-50%) scale(1) rotate(-2deg); }
        100% { transform: translateX(-50%) scale(1.1) rotate(2deg); }
    }

    @keyframes blowOut {
        0% { opacity: 1; transform: translateX(-50%) scale(1); }
        50% { opacity: 0.5; transform: translateX(-50%) scale(1.5) translateY(-10px); }
        100% { opacity: 0; transform: translateX(-50%) scale(0) translateY(-20px); }
    }

    .candles-counter {
        margin-top: 20px;
        font-size: 1.2rem;
        color: rgba(255, 255, 255, 0.8);
    }

    .candles-counter span {
        font-size: 2rem;
        font-weight: bold;
        background: linear-gradient(90deg, #ff6b9d, #ffc107);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .blow-btn {
        margin-top: 20px;
        padding: 15px 40px;
        background: linear-gradient(135deg, #ff6b9d, #ffc107);
        border: none;
        border-radius: 50px;
        color: #fff;
        font-family: 'Montserrat', sans-serif;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 10px 30px rgba(255, 107, 157, 0.4);
    }

    .blow-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 15px 40px rgba(255, 107, 157, 0.6);
    }

    .candles-reset-btn {
        margin-top: 10px;
        margin-left: 10px;
        padding: 12px 30px;
        background: linear-gradient(135deg, #4caf50, #8bc34a);
        border: none;
        border-radius: 50px;
        color: #fff;
        font-family: 'Montserrat', sans-serif;
        font-size: 0.9rem;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 8px 25px rgba(76, 175, 80, 0.4);
    }

    .candles-reset-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 30px rgba(76, 175, 80, 0.6);
    }

    .birthday-cake {
        position: relative;
        max-width: 350px;
        margin: 0 auto 20px;
    }

    .cake-layers {
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .cake-layer {
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }

    .cake-layer.layer-1 {
        width: 300px;
        height: 60px;
        background: linear-gradient(180deg, #ff8fab, #ff6b9d);
    }

    .cake-layer.layer-2 {
        width: 250px;
        height: 50px;
        background: linear-gradient(180deg, #f5e6d3, #e8d5c4);
        margin-top: -5px;
    }

    .cake-layer.layer-3 {
        width: 200px;
        height: 45px;
        background: linear-gradient(180deg, #ffc107, #ff9800);
        margin-top: -5px;
    }

    .candle {
        display: inline-flex;
        flex-direction: column;
        align-items: center;
        cursor: pointer;
        transition: transform 0.2s ease;
    }

    .candle:hover {
        transform: scale(1.1);
    }

    .candle-body {
        width: 6px;
        height: 25px;
        background: linear-gradient(180deg, #ffc107, #ff9800);
        border-radius: 2px;
    }

    .flame {
        width: 10px;
        height: 18px;
        background: radial-gradient(ellipse at bottom, #ffc107 0%, #ff6b00 40%, #ff0000 100%);
        border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
        animation: flicker 0.3s ease-in-out infinite alternate;
        box-shadow: 0 0 8px #ffc107, 0 0 15px #ff6b00, 0 0 25px #ff0000;
        transition: all 0.3s ease;
    }

    .flame-inner {
        width: 4px;
        height: 8px;
        background: #fff;
        border-radius: 50%;
        margin: 3px auto 0;
        opacity: 0.8;
    }

    .flame.flame-off {
        animation: blowOut 0.5s ease-out forwards;
    }

    @keyframes flicker {
        0% { transform: scale(1) rotate(-2deg); }
        100% { transform: scale(1.1) rotate(2deg); }
    }

    @keyframes blowOut {
        0% { opacity: 1; transform: scale(1); }
        50% { opacity: 0.5; transform: scale(1.5) translateY(-10px); }
        100% { opacity: 0; transform: scale(0) translateY(-20px); height: 0; }
    }

    .blow-message {
        display: none;
        margin-top: 20px;
        padding: 20px;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        font-family: 'Great Vibes', cursive;
        font-size: 1.5rem;
        color: #fff;
    }

    .candles-complete {
        display: none;
        margin-top: 30px;
        padding: 20px;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 20px;
    }

    .candles-complete.show {
        display: block;
        animation: fadeInUp 0.5s ease-out;
    }

    .candles-complete-text {
        font-family: 'Great Vibes', cursive;
        font-size: 2rem;
        background: linear-gradient(90deg, #ff6b9d, #ffc107);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    /* ========== SHAKE TO CELEBRATE ========== */
    .shake-indicator {
        position: fixed;
        bottom: 100px;
        left: 50%;
        transform: translateX(-50%);
        padding: 15px 30px;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 50px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        z-index: 1000;
        display: none;
        animation: shake-hint 1s ease-in-out infinite;
    }

    .shake-indicator.show {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    @keyframes shake-hint {
        0%, 100% { transform: translateX(-50%) rotate(-5deg); }
        50% { transform: translateX(-50%) rotate(5deg); }
    }

    .shake-icon {
        font-size: 1.5rem;
    }

    .shake-text {
        font-size: 0.9rem;
        color: rgba(255, 255, 255, 0.8);
    }

    /* ========== MEMORY GAME ========== */
    .memory-game-section {
        padding: 80px 20px;
        position: relative;
        z-index: 10;
    }

    .memory-game-section h2 {
        font-size: 2.5rem;
        color: #fff;
        margin-bottom: 15px;
        text-shadow: 0 0 30px rgba(255, 255, 255, 0.3);
    }

    .memory-subtitle {
        font-style: italic;
        color: rgba(255, 255, 255, 0.6);
        margin-bottom: 30px;
        font-size: 1.1rem;
    }

    .memory-stats {
        display: flex;
        justify-content: center;
        gap: 40px;
        margin-bottom: 30px;
        flex-wrap: wrap;
    }

    .stat-box {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        padding: 15px 30px;
        border-radius: 20px;
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .stat-label {
        font-size: 0.8rem;
        color: rgba(255, 255, 255, 0.6);
        text-transform: uppercase;
        letter-spacing: 2px;
    }

    .stat-value {
        font-size: 2rem;
        font-family: 'Playfair Display', serif;
        background: linear-gradient(90deg, #ff6b9d, #ffc107);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .memory-board {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 15px;
        max-width: 500px;
        margin: 0 auto 30px;
        perspective: 1000px;
    }

    @media (max-width: 500px) {
        .memory-board {
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
    }

    .memory-card {
        aspect-ratio: 1;
        cursor: pointer;
        position: relative;
        transform-style: preserve-3d;
        transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .memory-card.flipped {
        transform: rotateY(180deg);
    }

    .memory-card.matched {
        animation: matchPulse 0.5s ease-out;
    }

    @keyframes matchPulse {
        0%, 100% { transform: rotateY(180deg) scale(1); }
        50% { transform: rotateY(180deg) scale(1.1); }
    }

    .memory-card.matched::after {
        content: 'âœ¨';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 2rem;
        z-index: 10;
        animation: sparkleIn 0.5s ease-out;
    }

    @keyframes sparkleIn {
        0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
        100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
    }

    .card-face {
        position: absolute;
        width: 100%;
        height: 100%;
        backface-visibility: hidden;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }

    .card-back {
        background: linear-gradient(135deg, #ff6b9d, #c084fc);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        border: 2px solid rgba(255, 255, 255, 0.3);
    }

    .card-back::before {
        content: 'ðŸ’';
        animation: cardPulse 2s ease-in-out infinite;
    }

    @keyframes cardPulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.2); }
    }

    .card-front {
        transform: rotateY(180deg);
        background: #1a1a2e;
    }

    .card-front img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .memory-btn {
        display: inline-flex;
        align-items: center;
        gap: 10px;
        padding: 15px 40px;
        background: linear-gradient(135deg, #ff6b9d, #c084fc);
        border: none;
        border-radius: 50px;
        color: #fff;
        font-family: 'Montserrat', sans-serif;
        font-size: 1rem;
        letter-spacing: 2px;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 10px 30px rgba(255, 107, 157, 0.4);
    }

    .memory-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 15px 40px rgba(255, 107, 157, 0.6);
    }

    .memory-win-message {
        display: none;
        padding: 30px;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(20px);
        border-radius: 20px;
        border: 1px solid rgba(255, 107, 157, 0.3);
        margin-top: 20px;
    }

    .memory-win-message.show {
        display: block;
        animation: fadeInUp 0.5s ease-out;
    }

    .win-title {
        font-family: 'Great Vibes', cursive;
        font-size: 3rem;
        background: linear-gradient(90deg, #ff6b9d, #ffc107);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 10px;
    }

    .win-subtitle {
        color: rgba(255, 255, 255, 0.8);
        font-size: 1.1rem;
    }
</style>
</head>

<body>

<!-- Nebula Background -->
<div class="nebula">
    <div class="nebula-cloud"></div>
    <div class="nebula-cloud"></div>
    <div class="nebula-cloud"></div>
    <div class="nebula-cloud"></div>
</div>

<!-- ENVELOPE INTRO -->
<div class="envelope-intro" id="envelopeIntro" onclick="openEnvelope()">
    <div class="envelope-intro-stars" id="introStars"></div>
    
    <div class="floating-sparkles">
        <span class="sparkle" style="top: 20%; left: 15%; animation-delay: 0s;">âœ¨</span>
        <span class="sparkle" style="top: 30%; left: 80%; animation-delay: 0.5s;">ðŸ’«</span>
        <span class="sparkle" style="top: 60%; left: 10%; animation-delay: 1s;">ðŸŒŸ</span>
        <span class="sparkle" style="top: 70%; left: 85%; animation-delay: 1.5s;">âœ¨</span>
        <span class="sparkle" style="top: 15%; left: 50%; animation-delay: 0.3s;">ðŸ’–</span>
        <span class="sparkle" style="top: 80%; left: 40%; animation-delay: 0.8s;">ðŸŒŸ</span>
    </div>
    
    <div class="envelope-container">
        <div class="envelope" id="envelope">
            <div class="envelope-flap"></div>
            <div class="envelope-inner"></div>
            <div class="envelope-body">
                <div class="envelope-seal">ðŸ’</div>
                <div class="envelope-label">Para Principessa</div>
                <div class="envelope-decoration">â™¡ â™¡ â™¡</div>
            </div>
        </div>
    </div>
    
    <p class="click-hint">Clicca per aprire</p>
</div>

<!-- MAIN CONTENT -->
<div class="main-content" id="mainContent">

<div class="stars" id="stars"></div>
<div class="aurora"></div>
<div class="particles" id="particles"></div>
<canvas id="fireworks"></canvas>
<div class="floating-hearts" id="floatingHearts"></div>

<header class="hero">
    <div class="hero-decoration">âœ¨ ðŸŒŸ âœ¨</div>
    <h1>Per la Donna della Mia Vita</h1>
    <div class="script-title">Buon Compleanno</div>
    <p class="subtitle">
        <span class="age-highlight">55</span> anni di eleganza, bellezza e amore infinito
    </p>
</header>

<div class="container">
    
    <div class="divider">
        <div class="divider-line"></div>
        <div class="divider-ornament">ðŸ’Ž</div>
        <div class="divider-line"></div>
    </div>

    <section class="quotes-section">
        
        <div class="quote-card">
            <p class="quote-text">La famiglia Ã¨ dove la vita inizia e l'amore non finisce mai. Tu sei il cuore della nostra famiglia, la luce che illumina ogni giorno.</p>
            <div class="quote-category">âœ¦ Famiglia âœ¦</div>
        </div>

        <div class="quote-card">
            <p class="quote-text">Amarti Ã¨ la cosa piÃ¹ semplice e piÃ¹ bella che io abbia mai fatto. Ogni giorno con te Ã¨ un dono prezioso che custodisco nel cuore.</p>
            <div class="quote-category">âœ¦ Amore âœ¦</div>
        </div>

        <div class="quote-card">
            <p class="quote-text">Non Ã¨ la perfezione che rende la vita bella, ma l'amore con cui viviamo ogni momento insieme. Tu rendi perfetto ogni istante.</p>
            <div class="quote-category">âœ¦ Vita âœ¦</div>
        </div>

        <div class="quote-card">
            <p class="quote-text">Sei la poesia che non ho mai saputo scrivere, la melodia che risuona nel mio cuore. Insieme, abbiamo scritto la storia piÃ¹ bella.</p>
            <div class="quote-category">âœ¦ Sempre Insieme âœ¦</div>
        </div>

    </section>

    <div class="divider">
        <div class="divider-line"></div>
        <div class="divider-ornament">ðŸ’«</div>
        <div class="divider-line"></div>
    </div>

</div>

<section class="slider-section">
    <div class="container">
        <h2>âœ¨ Un Viaggio nel Tempo âœ¨</h2>
        <p class="slider-subtitle">Trascina per celebrare ogni anno della tua vita meravigliosa</p>
        
        <div class="slider-container">
            <div class="slider-label">
                <span>ðŸŒ± Inizio</span>
                <span>55 anni di magia ðŸŒŸ</span>
            </div>
            <input type="range" min="0" max="55" value="0" id="ageSlider">
            
            <div class="age-display">
                <div class="age-number" id="ageDisplay">0</div>
                <div class="age-label">anni di bellezza</div>
            </div>
            
            <button class="celebrate-btn" id="celebrateBtn" onclick="startCountdown()">
                <span class="btn-icon">ðŸŽ‰</span>
                <span>Inizia la Celebrazione</span>
                <span class="btn-icon">ðŸŽ‰</span>
            </button>
        </div>
    </div>
</section>

<div id="birthdayMessage">
    <div class="birthday-hearts">ðŸ’• âœ¨ ðŸŒŸ âœ¨ ðŸ’•</div>
    <div class="birthday-text">Buon Compleanno Amore Mio!</div>
    <div class="birthday-age">55</div>
    <div class="birthday-hearts">ðŸŽ‰ ðŸ’– ï¿½ï¿½ ðŸ’– ðŸŽ‰</div>
</div>

<section class="album-section">
    <h2 class="gallery-title">ðŸ“¸ 18 Dicembre nel Tempo... ðŸ’</h2>
    <p class="gallery-subtitle">Un viaggio attraverso i momenti piÃ¹ preziosi insieme</p>
    
    <div class="photo-gallery">
        <!-- Photos -->
        <div class="photo-card" onclick="openLightbox(this)">
            <img src="fotos/IMG_3274.JPG" alt="Ricordo" loading="lazy">
        </div>
        <div class="photo-card" onclick="openLightbox(this)">
            <img src="fotos/IMG_2147.JPG" alt="Ricordo" loading="lazy">
        </div>
        <div class="photo-card" onclick="openLightbox(this)">
            <img src="fotos/IMG_2143.JPG" alt="Ricordo" loading="lazy">
        </div>
        <div class="photo-card" onclick="openLightbox(this)">
            <img src="fotos/IMG_2109.JPG" alt="Ricordo" loading="lazy">
        </div>
        <div class="photo-card" onclick="openLightbox(this)">
            <img src="fotos/IMG_1713.JPG" alt="Ricordo" loading="lazy">
        </div>
        <div class="photo-card" onclick="openLightbox(this)">
            <img src="fotos/IMG_1701.JPG" alt="Ricordo" loading="lazy">
        </div>
        <div class="photo-card" onclick="openLightbox(this)">
            <img src="fotos/IMG_1131.JPG" alt="Ricordo" loading="lazy">
        </div>
        <div class="photo-card" onclick="openLightbox(this)">
            <img src="fotos/IMG_0703.JPG" alt="Ricordo" loading="lazy">
        </div>
        <div class="photo-card" onclick="openLightbox(this)">
            <img src="fotos/IMG_0696.JPG" alt="Ricordo" loading="lazy">
        </div>
        <div class="photo-card" onclick="openLightbox(this)">
            <img src="fotos/IMG_9713.JPG" alt="Ricordo" loading="lazy">
        </div>
        <div class="photo-card" onclick="openLightbox(this)">
            <img src="fotos/IMG_9711.jpg" alt="Ricordo" loading="lazy">
        </div>
        <div class="photo-card" onclick="openLightbox(this)">
            <img src="fotos/IMG_7447.jpg" alt="Ricordo" loading="lazy">
        </div>
        <div class="photo-card" onclick="openLightbox(this)">
            <img src="fotos/IMG_7440.jpg" alt="Ricordo" loading="lazy">
        </div>
        <div class="photo-card" onclick="openLightbox(this)">
            <img src="fotos/IMG_0330.jpg" alt="Ricordo" loading="lazy">
        </div>
        <div class="photo-card" onclick="openLightbox(this)">
            <img src="fotos/IMG_0322.jpg" alt="Ricordo" loading="lazy">
        </div>
        <div class="photo-card" onclick="openLightbox(this)">
            <img src="fotos/IMG_0136.PNG" alt="Ricordo" loading="lazy">
        </div>
        <div class="photo-card" onclick="openLightbox(this)">
            <img src="fotos/IMG_0085.jpg" alt="Ricordo" loading="lazy">
        </div>
        <div class="photo-card" onclick="openLightbox(this)">
            <img src="fotos/IMG_0081.JPG" alt="Ricordo" loading="lazy">
        </div>
        <div class="photo-card" onclick="openLightbox(this)">
            <img src="fotos/IMG_0070.jpg" alt="Ricordo" loading="lazy">
        </div>
        <div class="photo-card" onclick="openLightbox(this)">
            <img src="fotos/DSC00369.JPG" alt="Ricordo" loading="lazy">
        </div>
        <div class="photo-card" onclick="openLightbox(this)">
            <img src="fotos/DSCN6235.JPG" alt="Ricordo" loading="lazy">
        </div>
        <div class="photo-card" onclick="openLightbox(this)">
            <img src="fotos/DSCN5332.JPG" alt="Ricordo" loading="lazy">
        </div>
        <div class="photo-card" onclick="openLightbox(this)">
            <img src="fotos/DSCN5320.JPG" alt="Ricordo" loading="lazy">
        </div>
        <div class="photo-card" onclick="openLightbox(this)">
            <img src="fotos/IMGP0258.JPG" alt="Ricordo" loading="lazy">
        </div>
        <div class="photo-card" onclick="openLightbox(this)">
            <img src="fotos/138.JPG" alt="Ricordo" loading="lazy">
        </div>
        <div class="photo-card" onclick="openLightbox(this)">
            <img src="fotos/2011-12-17 10.42.30.jpg" alt="Ricordo" loading="lazy">
        </div>
        <div class="photo-card" onclick="openLightbox(this)">
            <img src="fotos/SNV32608.JPG" alt="Ricordo" loading="lazy">
        </div>
        <div class="photo-card" onclick="openLightbox(this)">
            <img src="fotos/SNV32607.JPG" alt="Ricordo" loading="lazy">
        </div>
        <div class="photo-card" onclick="openLightbox(this)">
            <img src="fotos/SNV32596.JPG" alt="Ricordo" loading="lazy">
        </div>
        <div class="photo-card" onclick="openLightbox(this)">
            <img src="fotos/SNV31579.JPG" alt="Ricordo" loading="lazy">
        </div>
        <div class="photo-card" onclick="openLightbox(this)">
            <img src="fotos/SNV31578.JPG" alt="Ricordo" loading="lazy">
        </div>
        <div class="photo-card" onclick="openLightbox(this)">
            <img src="fotos/SNV31568.JPG" alt="Ricordo" loading="lazy">
        </div>
        <div class="photo-card" onclick="openLightbox(this)">
            <img src="fotos/IMG_2889.jpg" alt="Ricordo" loading="lazy">
        </div>
        <div class="photo-card" onclick="openLightbox(this)">
            <img src="fotos/IMG_2894.jpg" alt="Ricordo" loading="lazy">
        </div>
        <div class="photo-card" onclick="openLightbox(this)">
            <img src="fotos/IMG_2901.jpg" alt="Ricordo" loading="lazy">
        </div>
        <!-- Videos -->
        <div class="photo-card video-card" onclick="openLightbox(this)" data-video="fotos/IMG_0070.MP4">
            <img src="fotos/IMG_0070.jpg" alt="Video" loading="lazy">
            <span class="video-indicator">â–¶</span>
        </div>
        <div class="photo-card video-card" onclick="openLightbox(this)" data-video="fotos/IMG_0085.MP4">
            <img src="fotos/IMG_0085.jpg" alt="Video" loading="lazy">
            <span class="video-indicator">â–¶</span>
        </div>
        <div class="photo-card video-card" onclick="openLightbox(this)" data-video="fotos/IMG_0689.MOV">
            <img src="fotos/IMG_0696.JPG" alt="Video" loading="lazy">
            <span class="video-indicator">â–¶</span>
        </div>
        <div class="photo-card video-card" onclick="openLightbox(this)" data-video="fotos/IMG_2889.MP4">
            <img src="fotos/IMG_2889.jpg" alt="Video" loading="lazy">
            <span class="video-indicator">â–¶</span>
        </div>
        <div class="photo-card video-card" onclick="openLightbox(this)" data-video="fotos/IMG_2894.MP4">
            <img src="fotos/IMG_2894.jpg" alt="Video" loading="lazy">
            <span class="video-indicator">â–¶</span>
        </div>
        <div class="photo-card video-card" onclick="openLightbox(this)" data-video="fotos/IMG_2901.MP4">
            <img src="fotos/IMG_2901.jpg" alt="Video" loading="lazy">
            <span class="video-indicator">â–¶</span>
        </div>
    </div>
</section>

<!-- ========== MEMORY GAME SECTION ========== -->
<section class="memory-game-section">
    <div class="container">
        <h2>ðŸŽ® Gioco della Memoria ðŸŽ®</h2>
        <p class="memory-subtitle">Trova le coppie di foto! Un gioco speciale con i nostri ricordi âœ¨</p>
        
        <div class="memory-stats">
            <div class="stat-box">
                <div class="stat-label">Mosse</div>
                <div class="stat-value" id="moveCount">0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Coppie</div>
                <div class="stat-value"><span id="matchCount">0</span>/6</div>
            </div>
        </div>
        
        <div class="memory-board" id="memoryBoard">
            <!-- Cards will be generated by JavaScript -->
        </div>
        
        <button class="memory-btn" onclick="initMemoryGame()">
            ðŸ”„ Nuova Partita
        </button>
        
        <div class="memory-win-message" id="winMessage">
            <div class="win-title">Bravissima! ðŸŽ‰</div>
            <div class="win-subtitle">Hai trovato tutte le coppie in <span id="finalMoves">0</span> mosse!</div>
        </div>
    </div>
</section>

<div class="divider">
    <div class="divider-line"></div>
    <div class="divider-ornament">ðŸŽ</div>
    <div class="divider-line"></div>
</div>

<!-- SCRATCH CARD SECTION -->
<section class="scratch-section">
    <div class="container">
        <h2>âœ¨ Gratta e Scopri âœ¨</h2>
        <p class="section-subtitle">Gratta la carta per scoprire un messaggio speciale!</p>
        
        <div class="scratch-card" id="scratchCard">
            <div class="scratch-message" id="scratchMessage">
                <div class="scratch-emoji">ðŸ’–</div>
                <div class="scratch-text">Sei la cosa piÃ¹ bella che mi sia mai capitata nella vita!</div>
            </div>
            <canvas class="scratch-canvas" id="scratchCanvas"></canvas>
        </div>
        
        <button class="scratch-btn" onclick="resetScratchCard()">ðŸ”„ Nuova Carta</button>
    </div>
</section>

<div class="divider">
    <div class="divider-line"></div>
    <div class="divider-ornament">ðŸŽ¡</div>
    <div class="divider-line"></div>
</div>

<!-- SPIN THE WHEEL SECTION -->
<section class="spin-section">
    <div class="container">
        <h2>ðŸŽ¡ Ruota della Fortuna ðŸŽ¡</h2>
        <p class="section-subtitle">Gira la ruota per scoprire cosa ti aspetta!</p>
        
        <button class="spin-btn" id="spinBtn" onclick="spinWheel()">ðŸŽ° Gira la Ruota!</button>
        
        <div class="wheel-container">
            <div class="wheel-pointer">â–¼</div>
            <div class="wheel" id="wheel">
                <div class="wheel-segment" style="--i: 0; --color: #ff6b9d;">
                    <span>Bacio</span>
                </div>
                <div class="wheel-segment" style="--i: 1; --color: #9c27b0;">
                    <span>Abbraccio</span>
                </div>
                <div class="wheel-segment" style="--i: 2; --color: #2196f3;">
                    <span>Cena</span>
                </div>
                <div class="wheel-segment" style="--i: 3; --color: #4caf50;">
                    <span>Massaggio</span>
                </div>
                <div class="wheel-segment" style="--i: 4; --color: #ff9800;">
                    <span>Viaggio</span>
                </div>
                <div class="wheel-segment" style="--i: 5; --color: #e91e63;">
                    <span>Sorpresa</span>
                </div>
                <div class="wheel-segment" style="--i: 6; --color: #00bcd4;">
                    <span>Cinema</span>
                </div>
                <div class="wheel-segment" style="--i: 7; --color: #ffc107;">
                    <span>Ti Amo!</span>
                </div>
            </div>
        </div>
        
        <div class="wheel-result" id="wheelResult"></div>
    </div>
</section>

<div class="divider">
    <div class="divider-line"></div>
    <div class="divider-ornament">ðŸ’Œ</div>
    <div class="divider-line"></div>
</div>

<!-- LOVE LETTER GENERATOR SECTION -->
<section class="love-letter-section">
    <div class="container">
        <h2>ðŸ’Œ Lettera d'Amore ðŸ’Œ</h2>
        <p class="section-subtitle">Genera una lettera d'amore speciale solo per te!</p>
        
        <div class="letter-box" id="letterBox">
            <div class="letter-header">Mia Carissima Principessa,</div>
            <div class="letter-content" id="letterContent">
                Clicca il bottone per generare una lettera d'amore unica...
            </div>
            <div class="letter-signature">Con tutto il mio amore,<br>Il tuo innamorato ðŸ’•</div>
        </div>
        
        <button class="letter-btn" onclick="generateLoveLetter()">âœ¨ Genera Lettera</button>
    </div>
</section>

<div class="divider">
    <div class="divider-line"></div>
    <div class="divider-ornament">ðŸŽ‚</div>
    <div class="divider-line"></div>
</div>

<!-- VIRTUAL CANDLES SECTION -->
<section class="candles-section">
    <div class="container">
        <h2>ðŸŽ‚ 55 Candeline ðŸŽ‚</h2>
        <p class="section-subtitle">Soffia sulle candeline per spegnerle! (usa il microfono o clicca)</p>
        
        <div class="birthday-cake" id="birthdayCake">
            <div class="cake-layers">
                <div class="cake-layer layer-1"></div>
                <div class="cake-layer layer-2"></div>
                <div class="cake-layer layer-3"></div>
            </div>
            <div class="candles-container" id="candlesContainer">
                <!-- 55 candles will be generated by JavaScript -->
            </div>
        </div>
        
        <div class="candles-counter">
            <span id="candlesLit">55</span> candeline accese
        </div>
        
        <button class="blow-btn" id="blowBtn" onclick="blowCandles()">ðŸ’¨ Soffia!</button>
        <button class="candles-reset-btn" onclick="resetCandles()">ðŸ”„ Riaccendi</button>
        
        <div class="blow-message" id="blowMessage"></div>
    </div>
</section>

<div class="divider">
    <div class="divider-line"></div>
    <div class="divider-ornament">ðŸ’«</div>
    <div class="divider-line"></div>
</div>

<!-- Flash Photo Container -->
<div class="flash-photo-container" id="flashPhotoContainer">
    <div class="flash-photo-card">
        <img src="" alt="Memory" id="flashPhotoImg">
    </div>
</div>

<!-- Lightbox -->
<div class="lightbox" id="lightbox" onclick="closeLightbox(event)">
    <span class="lightbox-close">&times;</span>
    <img src="" alt="Foto" id="lightboxImg">
    <video src="" id="lightboxVideo" controls style="display:none;"></video>
</div>

<footer>
    <div class="footer-heart">ðŸ’</div>
    <p class="footer-message">Con tutto il mio amore, oggi e per sempre</p>
    <p class="footer-signature">Il tuo amore</p>
    <p class="footer-date">18 Dicembre 2025</p>
    <button class="install-btn" id="installBtn" onclick="installPWA()">
        <span class="install-icon">ðŸ“²</span>
        <span>Installa sul Telefono</span>
    </button>
</footer>

<!-- Music Player -->
<div class="music-player" id="musicPlayer">
    <button class="music-btn" id="musicBtn" onclick="toggleMusic()">
        <span id="musicIcon">â–¶</span>
    </button>
    <div class="music-info">
        <span class="music-title">Ordinary Love</span>
        <span class="music-artist">U2</span>
    </div>
    <div class="music-bars">
        <div class="music-bar"></div>
        <div class="music-bar"></div>
        <div class="music-bar"></div>
        <div class="music-bar"></div>
    </div>
</div>

<!-- Audio Element -->
<audio id="backgroundMusic" loop preload="auto">
    <source src="music/17 Ordinary Love.mp3" type="audio/mpeg">
</audio>

</div><!-- End main-content -->

<script>
    // ========== ENVELOPE INTRO FUNCTIONS ==========
    function openEnvelope() {
        const envelope = document.getElementById('envelope');
        const envelopeIntro = document.getElementById('envelopeIntro');
        const mainContent = document.getElementById('mainContent');
        
        // Open the envelope flap
        envelope.classList.add('open');
        
        // After flap opens, fade out intro and show main content
        setTimeout(() => {
            envelopeIntro.classList.add('hidden');
            mainContent.classList.add('visible');
            
            // Initialize main content effects after it becomes visible
            setTimeout(() => {
                initializeMainContent();
            }, 500);
        }, 800);
    }

    // Create stars for envelope intro
    const introStarsContainer = document.getElementById('introStars');
    if (introStarsContainer) {
        for (let i = 0; i < 100; i++) {
            const star = document.createElement('div');
            star.className = 'star';
            star.style.left = Math.random() * 100 + 'vw';
            star.style.top = Math.random() * 100 + 'vh';
            star.style.animationDelay = Math.random() * 3 + 's';
            star.style.animationDuration = (1 + Math.random() * 2) + 's';
            introStarsContainer.appendChild(star);
        }
    }

    function initializeMainContent() {
        // Create stars
        const starsContainer = document.getElementById('stars');
        if (starsContainer) {
            for (let i = 0; i < 150; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + 'vw';
                star.style.top = Math.random() * 100 + 'vh';
                star.style.animationDelay = Math.random() * 3 + 's';
                star.style.animationDuration = (1 + Math.random() * 2) + 's';
                starsContainer.appendChild(star);
            }
        }

        // Create floating particles
        const particlesContainer = document.getElementById('particles');
        if (particlesContainer) {
            for (let i = 0; i < 30; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + 'vw';
                particle.style.animationDelay = Math.random() * 15 + 's';
                particle.style.animationDuration = (10 + Math.random() * 10) + 's';
                particle.style.width = (5 + Math.random() * 15) + 'px';
                particle.style.height = particle.style.width;
                particlesContainer.appendChild(particle);
            }
        }

        // Shooting stars
        function createShootingStar() {
            const mainContent = document.getElementById('mainContent');
            if (!mainContent.classList.contains('visible')) return;
            const star = document.createElement('div');
            star.className = 'shooting-star';
            star.style.left = Math.random() * 50 + 'vw';
            star.style.top = Math.random() * 30 + 'vh';
            document.body.appendChild(star);
            setTimeout(() => star.remove(), 1000);
        }
        setInterval(createShootingStar, 3000);
    } // End initializeMainContent

    const slider = document.getElementById('ageSlider');
    const ageDisplay = document.getElementById('ageDisplay');
    const message = document.getElementById('birthdayMessage');
    const floatingHearts = document.getElementById('floatingHearts');
    const celebrateBtn = document.getElementById('celebrateBtn');
    let hasTriggered = false;
    let isAnimating = false;

    slider.addEventListener('input', () => {
        const value = parseInt(slider.value);
        ageDisplay.textContent = value;
        ageDisplay.classList.add('pulse');
        
        setTimeout(() => {
            ageDisplay.classList.remove('pulse');
        }, 300);

        // Trigger celebration at 55
        if (value === 55 && !hasTriggered) {
            hasTriggered = true;
            triggerCelebration();
        }
    });

    // Photos array for flashing
    const photoList = [
        'fotos/IMG_3274.JPG', 'fotos/IMG_2147.JPG', 'fotos/IMG_2143.JPG',
        'fotos/IMG_2109.JPG', 'fotos/IMG_1713.JPG', 'fotos/IMG_1701.JPG',
        'fotos/IMG_1131.JPG', 'fotos/IMG_0703.JPG', 'fotos/IMG_0696.JPG',
        'fotos/IMG_9713.JPG', 'fotos/IMG_9711.jpg', 'fotos/IMG_7447.jpg',
        'fotos/IMG_7440.jpg', 'fotos/IMG_0330.jpg', 'fotos/IMG_0322.jpg',
        'fotos/IMG_0136.PNG', 'fotos/IMG_0085.jpg', 'fotos/IMG_0081.JPG',
        'fotos/IMG_0070.jpg', 'fotos/DSC00369.JPG', 'fotos/DSCN6235.JPG',
        'fotos/DSCN5332.JPG', 'fotos/DSCN5320.JPG', 'fotos/IMGP0258.JPG',
        'fotos/138.JPG', 'fotos/2011-12-17 10.42.30.jpg', 'fotos/SNV32608.JPG',
        'fotos/SNV32607.JPG', 'fotos/SNV32596.JPG', 'fotos/SNV31579.JPG',
        'fotos/SNV31578.JPG', 'fotos/SNV31568.JPG', 'fotos/IMG_2889.jpg',
        'fotos/IMG_2894.jpg', 'fotos/IMG_2901.jpg'
    ];

    const flashContainer = document.getElementById('flashPhotoContainer');
    const flashImg = document.getElementById('flashPhotoImg');
    let flashInterval = null;

    function flashRandomPhoto() {
        const randomPhoto = photoList[Math.floor(Math.random() * photoList.length)];
        flashImg.src = randomPhoto;
        flashContainer.classList.add('active');
        
        // Remove and re-add for animation
        const card = flashContainer.querySelector('.flash-photo-card');
        card.style.animation = 'none';
        card.offsetHeight; // Trigger reflow
        card.style.animation = 'flashPulse 0.15s ease-in-out';
    }

    function stopFlashingPhotos() {
        if (flashInterval) {
            clearInterval(flashInterval);
            flashInterval = null;
        }
        flashContainer.classList.remove('active');
    }

    function startCountdown() {
        if (isAnimating || hasTriggered) return;
        
        isAnimating = true;
        celebrateBtn.disabled = true;
        celebrateBtn.innerHTML = '<span class="btn-icon">ðŸŽ‚</span><span>Celebrando...</span><span class="btn-icon">ðŸŽ‚</span>';
        
        // Reset slider to 0
        slider.value = 0;
        ageDisplay.textContent = '0';
        
        // Start flashing photos rapidly
        flashRandomPhoto();
        flashInterval = setInterval(flashRandomPhoto, 100);
        
        let currentValue = 0;
        const targetValue = 55;
        const duration = 4000;
        const stepTime = duration / targetValue;
        
        const countInterval = setInterval(() => {
            currentValue++;
            slider.value = currentValue;
            ageDisplay.textContent = currentValue;
            ageDisplay.classList.add('pulse');
            
            // Add mini sparkles during countdown
            if (currentValue % 5 === 0) {
                createMiniSparkle();
            }
            
            setTimeout(() => {
                ageDisplay.classList.remove('pulse');
            }, 100);
            
            if (currentValue >= targetValue) {
                clearInterval(countInterval);
                stopFlashingPhotos();
                isAnimating = false;
                hasTriggered = true;
                triggerCelebration();
                celebrateBtn.innerHTML = '<span class="btn-icon">ðŸŽ‰</span><span>Auguri!</span><span class="btn-icon">ðŸŽ‰</span>';
            }
        }, stepTime);
    }

    function createMiniSparkle() {
        const colors = ['#ff6b9d', '#ffc107', '#c084fc', '#fff'];
        for (let i = 0; i < 5; i++) {
            const sparkle = document.createElement('div');
            sparkle.className = 'confetti';
            sparkle.style.left = (40 + Math.random() * 20) + 'vw';
            sparkle.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
            sparkle.style.width = '6px';
            sparkle.style.height = '6px';
            sparkle.style.borderRadius = '50%';
            sparkle.style.animationDuration = '1s';
            sparkle.style.boxShadow = '0 0 10px currentColor';
            document.body.appendChild(sparkle);
            setTimeout(() => sparkle.remove(), 1000);
        }
    }

    function triggerCelebration() {
        // Show birthday message
        message.style.display = 'block';
        message.scrollIntoView({ behavior: 'smooth', block: 'center' });
        
        // Start multiple effects
        startFireworks();
        createFloatingHearts();
        createConfetti();
        createExplosion();
        
        // Continue effects for a while
        let effectsCount = 0;
        const effectsInterval = setInterval(() => {
            startFireworks();
            if (effectsCount % 2 === 0) createFloatingHearts();
            effectsCount++;
            if (effectsCount >= 8) {
                clearInterval(effectsInterval);
            }
        }, 1200);
    }

    function createExplosion() {
        const colors = ['#ff6b9d', '#ffc107', '#c084fc', '#00ff88', '#00d4ff'];
        const centerX = window.innerWidth / 2;
        const centerY = window.innerHeight / 2;
        
        for (let i = 0; i < 50; i++) {
            setTimeout(() => {
                const burst = document.createElement('div');
                burst.style.position = 'fixed';
                burst.style.width = '15px';
                burst.style.height = '15px';
                burst.style.borderRadius = '50%';
                burst.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                burst.style.left = centerX + 'px';
                burst.style.top = centerY + 'px';
                burst.style.zIndex = '150';
                burst.style.boxShadow = '0 0 20px currentColor';
                burst.style.pointerEvents = 'none';
                
                const angle = (Math.PI * 2 * i) / 50;
                const distance = 100 + Math.random() * 200;
                const destX = Math.cos(angle) * distance;
                const destY = Math.sin(angle) * distance;
                
                burst.style.transition = 'all 1s ease-out';
                document.body.appendChild(burst);
                
                requestAnimationFrame(() => {
                    burst.style.transform = `translate(${destX}px, ${destY}px) scale(0)`;
                    burst.style.opacity = '0';
                });
                
                setTimeout(() => burst.remove(), 1000);
            }, i * 20);
        }
    }

    function createFloatingHearts() {
        floatingHearts.style.display = 'block';
        const hearts = ['â¤ï¸', 'ðŸ’•', 'ðŸ’–', 'ðŸ’—', 'ðŸ’', 'âœ¨', 'ðŸŒŸ', 'ðŸ’«', 'ðŸŒ¹', 'ðŸŽ‰'];
        
        for (let i = 0; i < 40; i++) {
            setTimeout(() => {
                const heart = document.createElement('div');
                heart.className = 'heart';
                heart.textContent = hearts[Math.floor(Math.random() * hearts.length)];
                heart.style.left = Math.random() * 100 + 'vw';
                heart.style.animationDuration = (4 + Math.random() * 3) + 's';
                heart.style.fontSize = (1.5 + Math.random() * 2) + 'rem';
                floatingHearts.appendChild(heart);
                
                setTimeout(() => heart.remove(), 6000);
            }, i * 100);
        }
    }

    function createConfetti() {
        const colors = ['#ff6b9d', '#ffc107', '#c084fc', '#00ff88', '#00d4ff', '#ff9999', '#ffcc99'];
        const shapes = ['50%', '0'];
        
        for (let i = 0; i < 120; i++) {
            setTimeout(() => {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.width = (8 + Math.random() * 12) + 'px';
                confetti.style.height = (8 + Math.random() * 12) + 'px';
                confetti.style.borderRadius = shapes[Math.floor(Math.random() * shapes.length)];
                confetti.style.animationDuration = (3 + Math.random() * 3) + 's';
                confetti.style.boxShadow = '0 0 10px ' + confetti.style.backgroundColor;
                document.body.appendChild(confetti);
                
                setTimeout(() => confetti.remove(), 6000);
            }, i * 30);
        }
    }

    /* Enhanced Fireworks */
    const canvas = document.getElementById('fireworks');
    const ctx = canvas.getContext('2d');
    
    function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);

    function startFireworks() {
        const colors = ['#ff6b9d', '#ffc107', '#c084fc', '#00ff88', '#00d4ff', '#ff4444', '#44ff44'];
        let particles = [];
        
        // Create multiple explosion points
        const numExplosions = 6 + Math.floor(Math.random() * 4);
        const explosionPoints = [];
        
        for (let i = 0; i < numExplosions; i++) {
            explosionPoints.push({
                x: canvas.width * (0.1 + Math.random() * 0.8),
                y: canvas.height * (0.1 + Math.random() * 0.5)
            });
        }
        
        explosionPoints.forEach((point, index) => {
            setTimeout(() => {
                const color = colors[Math.floor(Math.random() * colors.length)];
                const particleCount = 80 + Math.floor(Math.random() * 40);
                
                for (let i = 0; i < particleCount; i++) {
                    const angle = (Math.PI * 2 * i) / particleCount;
                    const velocity = 3 + Math.random() * 5;
                    particles.push({
                        x: point.x,
                        y: point.y,
                        dx: Math.cos(angle) * velocity,
                        dy: Math.sin(angle) * velocity,
                        life: 100 + Math.random() * 50,
                        color: color,
                        size: 2 + Math.random() * 3,
                        gravity: 0.02,
                        trail: []
                    });
                }
            }, index * 150);
        });

        function animate() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            particles.forEach(p => {
                // Draw trail
                p.trail.push({ x: p.x, y: p.y });
                if (p.trail.length > 5) p.trail.shift();
                
                p.trail.forEach((t, i) => {
                    ctx.beginPath();
                    ctx.arc(t.x, t.y, p.size * (i / p.trail.length) * (p.life / 100), 0, Math.PI * 2);
                    ctx.fillStyle = p.color;
                    ctx.globalAlpha = (i / p.trail.length) * (p.life / 150);
                    ctx.fill();
                });

                // Draw main particle
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size * (p.life / 100), 0, Math.PI * 2);
                ctx.fillStyle = p.color;
                ctx.globalAlpha = p.life / 100;
                ctx.shadowBlur = 20;
                ctx.shadowColor = p.color;
                ctx.fill();
                ctx.shadowBlur = 0;
                ctx.globalAlpha = 1;

                p.x += p.dx;
                p.y += p.dy;
                p.dy += p.gravity;
                p.dx *= 0.98;
                p.life -= 1.5;
            });

            particles = particles.filter(p => p.life > 0);
            
            if (particles.length > 0) {
                requestAnimationFrame(animate);
            } else {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            }
        }

        animate();
    }

    // Entrance animations on scroll
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateY(0)';
            }
        });
    }, observerOptions);

    document.querySelectorAll('.quote-card').forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(40px)';
        card.style.transition = `opacity 0.8s ease ${index * 0.15}s, transform 0.8s ease ${index * 0.15}s`;
        observer.observe(card);
    });

    // ========== LIGHTBOX FUNCTIONS ==========
    function openLightbox(card) {
        const lightbox = document.getElementById('lightbox');
        const lightboxImg = document.getElementById('lightboxImg');
        const lightboxVideo = document.getElementById('lightboxVideo');
        
        // Check if it's a video card
        const videoSrc = card.getAttribute('data-video');
        
        if (videoSrc) {
            // It's a video
            lightboxImg.style.display = 'none';
            lightboxVideo.style.display = 'block';
            lightboxVideo.src = videoSrc;
            lightboxVideo.play();
        } else {
            // It's an image
            const img = card.querySelector('img');
            lightboxVideo.style.display = 'none';
            lightboxVideo.pause();
            lightboxVideo.src = '';
            lightboxImg.style.display = 'block';
            lightboxImg.src = img.src;
        }
        
        lightbox.classList.add('active');
        document.body.style.overflow = 'hidden';
    }

    function closeLightbox(event) {
        // Don't close if clicking on the video controls
        if (event && event.target.tagName === 'VIDEO') return;
        
        const lightbox = document.getElementById('lightbox');
        const lightboxVideo = document.getElementById('lightboxVideo');
        
        lightboxVideo.pause();
        lightboxVideo.src = '';
        lightbox.classList.remove('active');
        document.body.style.overflow = '';
    }

    // Close lightbox with Escape key
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
            closeLightbox();
        }
    });

    // ========== MUSIC PLAYER ==========
    const backgroundMusic = document.getElementById('backgroundMusic');
    const musicBtn = document.getElementById('musicBtn');
    const musicIcon = document.getElementById('musicIcon');
    const musicPlayer = document.getElementById('musicPlayer');
    let isMusicPlaying = false;
    let isPlayingInProgress = false;

    function toggleMusic() {
        // Prevent multiple simultaneous calls
        if (isPlayingInProgress) return;
        
        if (isMusicPlaying) {
            backgroundMusic.pause();
            musicIcon.textContent = 'â–¶';
            musicBtn.classList.remove('playing');
            musicPlayer.classList.remove('playing');
            isMusicPlaying = false;
        } else {
            isPlayingInProgress = true;
            backgroundMusic.play().then(() => {
                musicIcon.textContent = 'â¸';
                musicBtn.classList.add('playing');
                musicPlayer.classList.add('playing');
                isMusicPlaying = true;
                isPlayingInProgress = false;
            }).catch(err => {
                console.log('Audio play failed:', err);
                isPlayingInProgress = false;
                isMusicPlaying = false;
            });
        }
    }

    // Start music function (called after envelope opens)
    function startMusic() {
        if (isMusicPlaying || isPlayingInProgress) return;
        
        isPlayingInProgress = true;
        backgroundMusic.play().then(() => {
            musicIcon.textContent = 'â¸';
            musicBtn.classList.add('playing');
            musicPlayer.classList.add('playing');
            isMusicPlaying = true;
            isPlayingInProgress = false;
        }).catch(err => {
            console.log('Auto-play blocked, user will need to click:', err.name);
            isPlayingInProgress = false;
            isMusicPlaying = false;
        });
    }

    // Auto-play music when envelope opens (with user interaction)
    const originalOpenEnvelope = openEnvelope;
    openEnvelope = function() {
        originalOpenEnvelope();
        // Try to start music after envelope opens
        setTimeout(startMusic, 1500);
    };

    // ========== CURSOR SPARKLE EFFECT ==========
    let lastSparkleTime = 0;
    document.addEventListener('mousemove', (e) => {
        const now = Date.now();
        if (now - lastSparkleTime < 50) return; // Throttle
        lastSparkleTime = now;
        
        const sparkle = document.createElement('div');
        sparkle.className = 'cursor-sparkle';
        sparkle.style.left = e.clientX + 'px';
        sparkle.style.top = e.clientY + 'px';
        
        const colors = ['#ff6b9d', '#ffc107', '#c084fc', '#00d4ff', '#fff'];
        sparkle.style.background = colors[Math.floor(Math.random() * colors.length)];
        sparkle.style.boxShadow = `0 0 10px ${sparkle.style.background}`;
        
        document.body.appendChild(sparkle);
        setTimeout(() => sparkle.remove(), 800);
    });

    // ========== FLOATING ORBS ==========
    function createFloatingOrbs() {
        const colors = [
            'rgba(255, 107, 157, 0.3)',
            'rgba(255, 193, 7, 0.3)',
            'rgba(192, 132, 252, 0.3)',
            'rgba(0, 212, 255, 0.3)'
        ];
        
        for (let i = 0; i < 8; i++) {
            const orb = document.createElement('div');
            orb.className = 'floating-orb';
            orb.style.width = (20 + Math.random() * 40) + 'px';
            orb.style.height = orb.style.width;
            orb.style.background = `radial-gradient(circle, ${colors[i % colors.length]}, transparent)`;
            orb.style.left = Math.random() * 100 + 'vw';
            orb.style.top = Math.random() * 100 + 'vh';
            orb.style.animationDelay = (Math.random() * 5) + 's';
            orb.style.animationDuration = (6 + Math.random() * 6) + 's';
            document.body.appendChild(orb);
        }
    }
    createFloatingOrbs();

    // ========== MEMORY GAME ==========
    const memoryPhotos = [
        'fotos/IMG_3274.JPG',
        'fotos/IMG_2147.JPG',
        'fotos/IMG_1713.JPG',
        'fotos/IMG_0696.JPG',
        'fotos/IMG_9711.jpg',
        'fotos/DSCN6235.JPG'
    ];

    let memoryCards = [];
    let flippedCards = [];
    let matchedPairs = 0;
    let moveCount = 0;
    let canFlip = true;

    function initMemoryGame() {
        const board = document.getElementById('memoryBoard');
        board.innerHTML = '';
        flippedCards = [];
        matchedPairs = 0;
        moveCount = 0;
        canFlip = true;
        
        document.getElementById('moveCount').textContent = '0';
        document.getElementById('matchCount').textContent = '0';
        document.getElementById('winMessage').classList.remove('show');
        
        // Create pairs and shuffle
        memoryCards = [...memoryPhotos, ...memoryPhotos];
        shuffleArray(memoryCards);
        
        // Create card elements
        memoryCards.forEach((photo, index) => {
            const card = document.createElement('div');
            card.className = 'memory-card';
            card.dataset.index = index;
            card.dataset.photo = photo;
            
            card.innerHTML = `
                <div class="card-face card-back"></div>
                <div class="card-face card-front">
                    <img src="${photo}" alt="Memory card">
                </div>
            `;
            
            card.addEventListener('click', () => flipCard(card));
            board.appendChild(card);
        });
    }

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    function flipCard(card) {
        if (!canFlip) return;
        if (card.classList.contains('flipped')) return;
        if (card.classList.contains('matched')) return;
        if (flippedCards.length >= 2) return;
        
        card.classList.add('flipped');
        flippedCards.push(card);
        
        if (flippedCards.length === 2) {
            moveCount++;
            document.getElementById('moveCount').textContent = moveCount;
            checkMatch();
        }
    }

    function checkMatch() {
        canFlip = false;
        const [card1, card2] = flippedCards;
        
        if (card1.dataset.photo === card2.dataset.photo) {
            // Match found!
            matchedPairs++;
            document.getElementById('matchCount').textContent = matchedPairs;
            
            setTimeout(() => {
                card1.classList.add('matched');
                card2.classList.add('matched');
                flippedCards = [];
                canFlip = true;
                
                // Check win
                if (matchedPairs === memoryPhotos.length) {
                    setTimeout(showWinMessage, 500);
                }
            }, 500);
        } else {
            // No match
            setTimeout(() => {
                card1.classList.remove('flipped');
                card2.classList.remove('flipped');
                flippedCards = [];
                canFlip = true;
            }, 1000);
        }
    }

    function showWinMessage() {
        document.getElementById('finalMoves').textContent = moveCount;
        document.getElementById('winMessage').classList.add('show');
        
        // Celebration effects
        createConfetti();
        createFloatingHearts();
    }

    // Initialize game on page load
    setTimeout(initMemoryGame, 100);

    // ========== SCRATCH CARD ==========
    let isScratching = false;
    let scratchCanvas, scratchCtx;
    let scratchInitialized = false;
    const scratchMessages = [
        { emoji: 'ðŸ’–', text: 'Sei la cosa piÃ¹ bella che mi sia mai capitata nella vita!' },
        { emoji: 'ðŸŒŸ', text: 'Ogni giorno con te Ã¨ un regalo prezioso!' },
        { emoji: 'ðŸ’•', text: 'Il mio cuore batte solo per te, oggi e sempre!' },
        { emoji: 'ðŸ¦‹', text: 'Sei la mia farfalla, porti colore nella mia vita!' },
        { emoji: 'ðŸŒ¹', text: 'Come una rosa, sei bella e unica al mondo!' },
        { emoji: 'ðŸ’Ž', text: 'Sei il mio tesoro piÃ¹ prezioso!' },
        { emoji: 'ðŸŒˆ', text: 'Sei il mio arcobaleno dopo ogni tempesta!' },
        { emoji: 'â­', text: 'Sei la stella che illumina le mie notti!' },
        { emoji: 'ðŸ”¥', text: 'Il nostro amore brucia piÃ¹ forte ogni giorno!' },
        { emoji: 'ðŸŽ', text: 'Tu sei il regalo piÃ¹ bello della mia vita!' }
    ];

    function initScratchCard() {
        scratchCanvas = document.getElementById('scratchCanvas');
        console.log('initScratchCard called, canvas:', scratchCanvas);
        if (!scratchCanvas) return;
        
        scratchCtx = scratchCanvas.getContext('2d');
        scratchCanvas.width = 300;
        scratchCanvas.height = 200;
        
        console.log('Canvas initialized:', scratchCanvas.width, 'x', scratchCanvas.height);
        
        // Reset composite operation
        scratchCtx.globalCompositeOperation = 'source-over';
        
        // Draw scratch surface
        const gradient = scratchCtx.createLinearGradient(0, 0, 300, 200);
        gradient.addColorStop(0, '#c9a227');
        gradient.addColorStop(0.5, '#e8d48b');
        gradient.addColorStop(1, '#c9a227');
        scratchCtx.fillStyle = gradient;
        scratchCtx.fillRect(0, 0, 300, 200);
        
        // Add text
        scratchCtx.fillStyle = '#8b6914';
        scratchCtx.font = 'bold 20px Arial';
        scratchCtx.textAlign = 'center';
        scratchCtx.fillText('âœ¨ GRATTA QUI âœ¨', 150, 100);
        scratchCtx.font = '14px Arial';
        scratchCtx.fillText('Scopri il messaggio', 150, 130);
        
        // Only add event listeners once
        if (!scratchInitialized) {
            // Mouse events
            scratchCanvas.addEventListener('mousedown', startScratch);
            scratchCanvas.addEventListener('mousemove', scratch);
            scratchCanvas.addEventListener('mouseup', stopScratch);
            scratchCanvas.addEventListener('mouseleave', stopScratch);
            
            // Touch events
            scratchCanvas.addEventListener('touchstart', startScratch, { passive: false });
            scratchCanvas.addEventListener('touchmove', scratch, { passive: false });
            scratchCanvas.addEventListener('touchend', stopScratch);
            
            scratchInitialized = true;
        }
    }

    function startScratch(e) {
        e.preventDefault();
        console.log('startScratch called');
        isScratching = true;
        scratch(e);
    }

    function scratch(e) {
        if (!isScratching || !scratchCtx) return;
        e.preventDefault();
        
        const rect = scratchCanvas.getBoundingClientRect();
        let x, y;
        
        if (e.touches) {
            x = e.touches[0].clientX - rect.left;
            y = e.touches[0].clientY - rect.top;
        } else {
            x = e.clientX - rect.left;
            y = e.clientY - rect.top;
        }
        
        // Scale coordinates to canvas size
        x = x * (scratchCanvas.width / rect.width);
        y = y * (scratchCanvas.height / rect.height);
        
        console.log('Scratching at:', x, y);
        
        scratchCtx.globalCompositeOperation = 'destination-out';
        scratchCtx.beginPath();
        scratchCtx.arc(x, y, 25, 0, Math.PI * 2);
        scratchCtx.fill();
    }

    function stopScratch() {
        isScratching = false;
    }

    function resetScratchCard() {
        // Change message
        const msg = scratchMessages[Math.floor(Math.random() * scratchMessages.length)];
        document.querySelector('.scratch-emoji').textContent = msg.emoji;
        document.querySelector('.scratch-text').textContent = msg.text;
        
        // Reinitialize canvas
        initScratchCard();
    }

    // ========== SPIN THE WHEEL ==========
    let isSpinning = false;
    let wheelRotation = 0;
    const wheelPrizes = [
        { name: 'Bacio', emoji: 'ðŸ’‹', message: 'Hai vinto un bacio appassionato!' },
        { name: 'Abbraccio', emoji: 'ðŸ¤—', message: 'Hai vinto un abbraccio fortissimo!' },
        { name: 'Cena', emoji: 'ðŸ½ï¸', message: 'Hai vinto una cena romantica!' },
        { name: 'Massaggio', emoji: 'ðŸ’†', message: 'Hai vinto un massaggio rilassante!' },
        { name: 'Viaggio', emoji: 'âœˆï¸', message: 'Hai vinto un viaggio insieme!' },
        { name: 'Sorpresa', emoji: 'ðŸŽ', message: 'Hai vinto una sorpresa speciale!' },
        { name: 'Cinema', emoji: 'ðŸŽ¬', message: 'Hai vinto una serata al cinema!' },
        { name: 'Ti Amo!', emoji: 'â¤ï¸', message: 'Ti amo infinitamente!' }
    ];

    function spinWheel() {
        if (isSpinning) return;
        isSpinning = true;
        
        const spinBtn = document.getElementById('spinBtn');
        const wheel = document.getElementById('wheel');
        const resultDiv = document.getElementById('wheelResult');
        
        spinBtn.disabled = true;
        resultDiv.textContent = '';
        resultDiv.style.display = 'none';
        
        // Random rotation (5-10 full spins + random position)
        const spins = 5 + Math.random() * 5;
        const randomAngle = Math.random() * 360;
        const totalRotation = spins * 360 + randomAngle;
        
        wheelRotation += totalRotation;
        wheel.style.transform = `rotate(${wheelRotation}deg)`;
        
        // Calculate winner after spin
        setTimeout(() => {
            // Each segment is 45 degrees (360/8)
            const normalizedRotation = wheelRotation % 360;
            const segmentAngle = 360 / 8;
            // The pointer is at top, so we need to adjust
            const winningIndex = Math.floor((360 - normalizedRotation + segmentAngle / 2) / segmentAngle) % 8;
            
            const prize = wheelPrizes[winningIndex];
            resultDiv.innerHTML = `<span class="prize-emoji">${prize.emoji}</span> ${prize.message}`;
            resultDiv.style.display = 'block';
            
            // Celebration
            createConfetti();
            
            isSpinning = false;
            spinBtn.disabled = false;
        }, 5000);
    }

    // ========== LOVE LETTER GENERATOR ==========
    const letterOpenings = [
        "In questo giorno speciale, voglio dirti quanto sei importante per me.",
        "Ogni volta che ti guardo, il mio cuore si riempie di gioia infinita.",
        "55 anni di vita meravigliosa, e ogni giorno sei sempre piÃ¹ bella.",
        "Non esistono parole sufficienti per descrivere quanto ti amo.",
        "Sei la mia principessa, la mia regina, il mio tutto."
    ];

    const letterMiddles = [
        "I tuoi occhi brillano come stelle, illuminando ogni mio giorno. Il tuo sorriso Ã¨ la mia medicina, la tua voce Ã¨ la mia musica preferita.",
        "Ogni momento passato insieme Ã¨ un tesoro che custodisco nel cuore. Sei la persona piÃ¹ speciale che conosca.",
        "Mi hai insegnato cosa significa amare veramente. Con te ho scoperto la felicitÃ  piÃ¹ pura.",
        "Quando ti vedo, il mondo si ferma. Sei la ragione per cui sorrido ogni mattina.",
        "La tua gentilezza, la tua forza, la tua bellezza mi conquistano ogni giorno di piÃ¹."
    ];

    const letterClosings = [
        "Prometto di amarti oggi, domani e per sempre. Sei il mio destino, la mia anima gemella.",
        "Che questi 55 anni siano solo l'inizio di infinite avventure insieme. Ti amo piÃ¹ della vita stessa.",
        "Buon compleanno, amore mio. Che ogni tuo desiderio si avveri, perchÃ© tu meriti tutto il bello del mondo.",
        "Grazie per essere entrata nella mia vita. Sei il regalo piÃ¹ prezioso che potessi mai ricevere.",
        "Con te, ogni giorno Ã¨ una festa. Ti amo immensamente, mia adorata principessa."
    ];

    function generateLoveLetter() {
        const opening = letterOpenings[Math.floor(Math.random() * letterOpenings.length)];
        const middle = letterMiddles[Math.floor(Math.random() * letterMiddles.length)];
        const closing = letterClosings[Math.floor(Math.random() * letterClosings.length)];
        
        const letterContent = document.getElementById('letterContent');
        letterContent.style.opacity = '0';
        
        setTimeout(() => {
            letterContent.innerHTML = `<p>${opening}</p><p>${middle}</p><p>${closing}</p>`;
            letterContent.style.opacity = '1';
        }, 300);
        
        // Add sparkle effect
        const letterBox = document.getElementById('letterBox');
        letterBox.style.animation = 'none';
        setTimeout(() => {
            letterBox.style.animation = 'letterGlow 1s ease-in-out';
        }, 10);
    }

    // ========== VIRTUAL CANDLES ==========
    let candlesLit = 55;
    let audioContext, analyser, microphone;
    let blowDetectionActive = false;

    function initCandles() {
        const container = document.getElementById('candlesContainer');
        if (!container) return;
        
        container.innerHTML = '';
        candlesLit = 55;
        updateCandlesCounter();
        
        // Create 55 candles in rows
        for (let i = 0; i < 55; i++) {
            const candle = document.createElement('div');
            candle.className = 'candle';
            candle.innerHTML = `
                <div class="flame" id="flame-${i}">
                    <div class="flame-inner"></div>
                </div>
                <div class="candle-body"></div>
            `;
            candle.onclick = () => blowSingleCandle(i);
            container.appendChild(candle);
        }
    }

    function blowSingleCandle(index) {
        const flame = document.getElementById(`flame-${index}`);
        if (flame && !flame.classList.contains('flame-off')) {
            flame.classList.add('flame-off');
            candlesLit--;
            updateCandlesCounter();
            checkAllCandlesBlown();
        }
    }

    function blowCandles() {
        // Blow random 5-15 candles
        const numToBlow = 5 + Math.floor(Math.random() * 10);
        let blown = 0;
        
        for (let i = 0; i < 55 && blown < numToBlow; i++) {
            const flame = document.getElementById(`flame-${i}`);
            if (flame && !flame.classList.contains('flame-off')) {
                setTimeout(() => {
                    flame.classList.add('flame-off');
                    candlesLit--;
                    updateCandlesCounter();
                    checkAllCandlesBlown();
                }, blown * 100);
                blown++;
            }
        }
    }

    function updateCandlesCounter() {
        const counter = document.getElementById('candlesLit');
        if (counter) counter.textContent = candlesLit;
    }

    function checkAllCandlesBlown() {
        if (candlesLit <= 0) {
            const blowMessage = document.getElementById('blowMessage');
            if (blowMessage) {
                blowMessage.innerHTML = 'ðŸŽ‰ Bravissima! Hai spento tutte le candeline! ðŸŽ‚<br>Esprimi un desiderio! âœ¨';
                blowMessage.style.display = 'block';
            }
            createConfetti();
            createFloatingHearts();
        }
    }

    function resetCandles() {
        const blowMessage = document.getElementById('blowMessage');
        if (blowMessage) blowMessage.style.display = 'none';
        initCandles();
    }

    // Microphone blow detection
    async function initBlowDetection() {
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            analyser = audioContext.createAnalyser();
            microphone = audioContext.createMediaStreamSource(stream);
            microphone.connect(analyser);
            
            analyser.fftSize = 256;
            const bufferLength = analyser.frequencyBinCount;
            const dataArray = new Uint8Array(bufferLength);
            
            blowDetectionActive = true;
            
            function detectBlow() {
                if (!blowDetectionActive) return;
                
                analyser.getByteFrequencyData(dataArray);
                const average = dataArray.reduce((a, b) => a + b) / bufferLength;
                
                // If loud enough, blow some candles
                if (average > 50) {
                    blowCandles();
                }
                
                requestAnimationFrame(detectBlow);
            }
            
            detectBlow();
        } catch (err) {
            console.log('Microphone not available:', err);
        }
    }

    // ========== SHAKE TO CELEBRATE ==========
    let lastShakeTime = 0;
    const shakeThreshold = 15;
    let lastX, lastY, lastZ;

    function initShakeDetection() {
        if (window.DeviceMotionEvent) {
            window.addEventListener('devicemotion', handleShake);
        }
    }

    function handleShake(event) {
        const acceleration = event.accelerationIncludingGravity;
        if (!acceleration) return;
        
        const currentTime = Date.now();
        
        if ((currentTime - lastShakeTime) > 100) {
            const diffTime = currentTime - lastShakeTime;
            lastShakeTime = currentTime;
            
            const x = acceleration.x || 0;
            const y = acceleration.y || 0;
            const z = acceleration.z || 0;
            
            const speed = Math.abs(x + y + z - (lastX || 0) - (lastY || 0) - (lastZ || 0)) / diffTime * 10000;
            
            if (speed > shakeThreshold) {
                // Shake detected - celebrate!
                createConfetti();
                createFloatingHearts();
                
                // Show shake indicator
                let indicator = document.querySelector('.shake-indicator');
                if (!indicator) {
                    indicator = document.createElement('div');
                    indicator.className = 'shake-indicator';
                    indicator.innerHTML = 'ðŸŽ‰ Shake! ðŸŽ‰';
                    document.body.appendChild(indicator);
                }
                indicator.style.display = 'block';
                setTimeout(() => {
                    indicator.style.display = 'none';
                }, 1000);
            }
            
            lastX = x;
            lastY = y;
            lastZ = z;
        }
    }

    // ========== CURSOR SPARKLE EFFECT ==========
    function initCursorSparkles() {
        document.addEventListener('mousemove', (e) => {
            if (Math.random() > 0.9) { // Only create sparkle 10% of the time
                createSparkle(e.clientX, e.clientY);
            }
        });
    }

    function createSparkle(x, y) {
        const sparkle = document.createElement('div');
        sparkle.style.cssText = `
            position: fixed;
            left: ${x}px;
            top: ${y}px;
            width: 8px;
            height: 8px;
            background: radial-gradient(circle, #fff 0%, #ff6b9d 50%, transparent 70%);
            border-radius: 50%;
            pointer-events: none;
            z-index: 9999;
            animation: sparkle 0.6s ease-out forwards;
        `;
        document.body.appendChild(sparkle);
        
        setTimeout(() => sparkle.remove(), 600);
    }

    // Add sparkle animation if not exists
    if (!document.querySelector('#sparkle-style')) {
        const style = document.createElement('style');
        style.id = 'sparkle-style';
        style.textContent = `
            @keyframes sparkle {
                0% { transform: scale(1); opacity: 1; }
                100% { transform: scale(0); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
    }

    // ========== PARTICLE EXPLOSION ==========
    function createParticleExplosion(x, y, count = 30) {
        for (let i = 0; i < count; i++) {
            const particle = document.createElement('div');
            const angle = (Math.PI * 2 * i) / count;
            const velocity = 2 + Math.random() * 3;
            const size = 4 + Math.random() * 6;
            const color = ['#ff6b9d', '#ffc107', '#9c27b0', '#2196f3', '#4caf50'][Math.floor(Math.random() * 5)];
            
            particle.style.cssText = `
                position: fixed;
                left: ${x}px;
                top: ${y}px;
                width: ${size}px;
                height: ${size}px;
                background: ${color};
                border-radius: 50%;
                pointer-events: none;
                z-index: 9999;
            `;
            document.body.appendChild(particle);
            
            const vx = Math.cos(angle) * velocity;
            const vy = Math.sin(angle) * velocity;
            let posX = x;
            let posY = y;
            let opacity = 1;
            
            function animate() {
                posX += vx;
                posY += vy + 0.5; // gravity
                opacity -= 0.02;
                
                if (opacity <= 0) {
                    particle.remove();
                    return;
                }
                
                particle.style.left = posX + 'px';
                particle.style.top = posY + 'px';
                particle.style.opacity = opacity;
                
                requestAnimationFrame(animate);
            }
            
            animate();
        }
    }

    // Add click explosion effect to buttons
    document.addEventListener('click', (e) => {
        if (e.target.matches('button')) {
            createParticleExplosion(e.clientX, e.clientY, 15);
        }
    });

    // ========== INITIALIZE ALL NEW FEATURES ==========
    window.addEventListener('load', () => {
        setTimeout(() => {
            initScratchCard();
            initCandles();
            initShakeDetection();
            initCursorSparkles();
        }, 500);
    });

    // ========== PWA SERVICE WORKER & INSTALL ==========
    let deferredPrompt;
    const installBtn = document.getElementById('installBtn');

    // Listen for the beforeinstallprompt event
    window.addEventListener('beforeinstallprompt', (e) => {
        console.log('beforeinstallprompt fired');
        // Prevent Chrome 67+ from automatically showing the prompt
        e.preventDefault();
        // Save the event so it can be triggered later
        deferredPrompt = e;
        // Show the install button
        installBtn.style.display = 'inline-flex';
    });

    // Install button click handler
    function installPWA() {
        if (deferredPrompt) {
            // Show the install prompt
            deferredPrompt.prompt();
            // Wait for the user to respond
            deferredPrompt.userChoice.then((choiceResult) => {
                if (choiceResult.outcome === 'accepted') {
                    console.log('User accepted the install prompt');
                    installBtn.style.display = 'none';
                } else {
                    console.log('User dismissed the install prompt');
                }
                deferredPrompt = null;
            });
        } else {
            // For iOS or browsers that don't support beforeinstallprompt
            alert('Per installare questa app:\n\nðŸ“± iPhone/iPad: Tocca il pulsante Condividi e poi "Aggiungi a Home"\n\nðŸ¤– Android: Tocca il menu (â‹®) e poi "Installa app"');
        }
    }

    // Listen for successful installation
    window.addEventListener('appinstalled', (evt) => {
        console.log('App was installed');
        installBtn.style.display = 'none';
        // Show celebration
        createConfetti();
    });

    // Register service worker
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('sw.js')
                .then(registration => {
                    console.log('SW registered:', registration.scope);
                    // Check for updates
                    registration.onupdatefound = () => {
                        const installingWorker = registration.installing;
                        installingWorker.onstatechange = () => {
                            if (installingWorker.state === 'installed') {
                                if (navigator.serviceWorker.controller) {
                                    console.log('New content available, refresh for update');
                                }
                            }
                        };
                    };
                })
                .catch(err => {
                    console.log('SW registration failed:', err);
                });
        });
    }

    // Check if running as installed PWA
    if (window.matchMedia('(display-mode: standalone)').matches) {
        console.log('Running as installed PWA');
        // Hide install button if already installed
        installBtn.style.display = 'none';
    }
</script>

</body>
</html>
